<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function fits a  Variable Length Markov Chain with covariates (coVLMC)
to a discrete time series coupled with a time series of covariates."><title>Fit a Variable Length Markov Chain with Covariates (coVLMC) — covlmc • mixvlmc</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a Variable Length Markov Chain with Covariates (coVLMC) — covlmc"><meta property="og:description" content="This function fits a  Variable Length Markov Chain with covariates (coVLMC)
to a discrete time series coupled with a time series of covariates."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mixvlmc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/context-trees.html">Context trees</a>
    <a class="dropdown-item" href="../articles/covlmc.html">Variable Length Markov Chains with Covariates (COVLMC)</a>
    <a class="dropdown-item" href="../articles/sampling.html">Sampling from (CO)VLMC</a>
    <a class="dropdown-item" href="../articles/variable-length-markov-chains.html">Variable length Markov chains (VLMC)</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/mixvlmc-0-1.html">mixvlmc 0.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fabrice-rossi/mixvlmc/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fit a Variable Length Markov Chain with Covariates (coVLMC)</h1>
      <small class="dont-index">Source: <a href="https://github.com/fabrice-rossi/mixvlmc/blob/HEAD/R/covlmc.R" class="external-link"><code>R/covlmc.R</code></a></small>
      <div class="d-none name"><code>covlmc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function fits a  Variable Length Markov Chain with covariates (coVLMC)
to a discrete time series coupled with a time series of covariates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">covlmc</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">covariate</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  min_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  max_depth <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  keep_data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="covlmc_control.html">covlmc_control</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>a discrete time series; can be numeric, character or factor.</p></dd>


<dt>covariate</dt>
<dd><p>a data frame of covariates.</p></dd>


<dt>alpha</dt>
<dd><p>number in (0,1) (default: 0.05) cut off value in the pruning
phase (in quantile scale).</p></dd>


<dt>min_size</dt>
<dd><p>number &gt;= 1 (default: 5). Tune the minimum number of
observations for a context in the growing phase of the context tree (see
below for details).</p></dd>


<dt>max_depth</dt>
<dd><p>integer &gt;= 1 (default: 100). Longest context considered in
growing phase of the context tree.</p></dd>


<dt>keep_data</dt>
<dd><p>logical (defaults to <code>TRUE</code>). If <code>TRUE</code>, the original data
are stored in the resulting object to enable post pruning (see
<code><a href="prune.covlmc.html">prune.covlmc()</a></code>).</p></dd>


<dt>control</dt>
<dd><p>a list with control parameters, see <code><a href="covlmc_control.html">covlmc_control()</a></code>.</p></dd>


<dt>...</dt>
<dd><p>arguments passed to <code><a href="covlmc_control.html">covlmc_control()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a fitted covlmc model.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The model is built using the algorithm described in Zanin Zambom et al. As
for the <code><a href="vlmc.html">vlmc()</a></code> approach, the algorithm builds first a context tree (see
<code><a href="ctx_tree.html">ctx_tree()</a></code>). The <code>min_size</code> parameter is used to compute the actual number
of observations per context in the growing phase of the tree. It is computed
as <code>min_size*(1+ncol(covariate)*d)*(s-1)</code> where <code>d</code> is the length of the
context (a.k.a. the depth in the tree) and <code>s</code> is the number of states. This
corresponds to ensuring min_size observations per parameter of the logistic
regression during the estimation phase.</p>
<p>Then logistic models are adjusted in the leaves at the tree: the goal of each
logistic model is to estimate the conditional distribution of the next state
of the times series given the context (the recent past of the time series)
and delayed versions of the covariates. A pruning strategy is used to
simplified the models (mainly to reduce the time window associated to the
covariates) and the tree itself.</p>
<p>Parameters specified by <code>control</code> are used to fine tune the behaviour of the
algorithm.</p>
    </div>
    <div class="section level2">
    <h2 id="logistic-models">Logistic models<a class="anchor" aria-label="anchor" href="#logistic-models"></a></h2>
    


<p>By default, <code>covlmc</code> uses two different computing <em>engines</em> for logistic
models:</p><ul><li><p>when the time series has only two states, <code>covlmc</code> uses <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code>
with a binomial link (<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">stats::binomial()</a></code>);</p></li>
<li><p>when the time series has at least three
states, <code>covlmc</code> use <code><a href="https://rdrr.io/pkg/VGAM/man/vglm.html" class="external-link">VGAM::vglm()</a></code> with a multinomial link
(<code><a href="https://rdrr.io/pkg/VGAM/man/multinomial.html" class="external-link">VGAM::multinomial()</a></code>).</p></li>
</ul><p>Both engines are able to detect degenerate cases and lead to more robust
results that using <code><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">nnet::multinom()</a></code>. It is nevertheless possible to
replace <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> and <code><a href="https://rdrr.io/pkg/VGAM/man/vglm.html" class="external-link">VGAM::vglm()</a></code> with <code><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">nnet::multinom()</a></code> by setting
the global option <code>mixvlmc.predictive</code> to <code>"multinom"</code> (the default value is
<code>"glm"</code>). Notice that while results should be comparable, there is no
guarantee that they will be identical.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    
<ul><li><p>Bühlmann, P. and Wyner, A. J. (1999), "Variable length Markov chains." Ann.
Statist. 27 (2) 480-513 <a href="https://doi.org/10.1214/aos/1018031204" class="external-link">doi:10.1214/aos/1018031204</a></p></li>
<li><p>Zanin Zambom, A., Kim, S. and Lopes Garcia, N. (2022), "Variable length Markov chain
with exogenous covariates." J. Time Ser. Anal., 43 (2)
312-328 <a href="https://doi.org/10.1111/jtsa.12615" class="external-link">doi:10.1111/jtsa.12615</a></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="cutoff.covlmc.html">cutoff.covlmc()</a></code> and <code><a href="prune.covlmc.html">prune.covlmc()</a></code> for post-pruning.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="va">powerconsumption</span><span class="op">[</span><span class="va">powerconsumption</span><span class="op">$</span><span class="va">week</span> <span class="op">==</span> <span class="fl">5</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">active_power</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">active_power</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span>, <span class="fl">2</span> <span class="op">/</span> <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dts_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>day_night <span class="op">=</span> <span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">hour</span> <span class="op">&gt;=</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">pc</span><span class="op">$</span><span class="va">hour</span> <span class="op">&lt;=</span> <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m_cov</span> <span class="op">&lt;-</span> <span class="fu">covlmc</span><span class="op">(</span><span class="va">dts</span>, <span class="va">dts_cov</span>, min_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="draw.html">draw</a></span><span class="op">(</span><span class="va">m_cov</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * (merging ((0.556,1.78] and (1.78,7.54]): 1.347e-96)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +-- (0,0.556] (0.001385 [ -2.885 1.237</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |                         -4.185 -15.4 ])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> '-- (0.556,1.78] (0.8622 [ 2.046 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |                          0.1372 ])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> '-- (1.78,7.54] (0.227 [ 3.714</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          5.684 ])</span>
<span class="r-in"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">with_options</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mixvlmc.predictive <span class="op">=</span> <span class="st">"multinom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">m_cov_nnet</span> <span class="op">&lt;-</span> <span class="fu">covlmc</span><span class="op">(</span><span class="va">dts</span>, <span class="va">dts_cov</span>, min_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="draw.html">draw</a></span><span class="op">(</span><span class="va">m_cov_nnet</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * (merging ((0.556,1.78] and (1.78,7.54]): 1.347e-96)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> +-- (0,0.556] (0.001386 [ -2.885 1.237 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |                         -4.185 -7.944 ])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> '-- (0.556,1.78] (0.8622 [ 2.046 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |                          0.1372 ])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> '-- (1.78,7.54] (0.2274 [ 3.714</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           5.684 ])</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Fabrice Rossi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

