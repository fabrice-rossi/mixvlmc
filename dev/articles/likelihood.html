<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mixvlmc">
<title>Likelihood calculation • mixvlmc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Likelihood calculation">
<meta property="og:description" content="mixvlmc">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mixvlmc</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/context-trees.html">Context trees</a>
    <a class="dropdown-item" href="../articles/variable-length-markov-chains.html">Variable length Markov chains (VLMC)</a>
    <a class="dropdown-item" href="../articles/covlmc.html">Variable Length Markov Chains with Covariates (COVLMC)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced topics</h6>
    <a class="dropdown-item" href="../articles/likelihood.html">Likelihood calculation</a>
    <a class="dropdown-item" href="../articles/sampling.html">Sampling from (CO)VLMC</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/mixvlmc-0-1.html">mixvlmc 0.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fabrice-rossi/mixvlmc/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Likelihood calculation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fabrice-rossi/mixvlmc/blob/HEAD/vignettes/likelihood.Rmd" class="external-link"><code>vignettes/likelihood.Rmd</code></a></small>
      <div class="d-none name"><code>likelihood.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fabrice-rossi/mixvlmc" class="external-link">mixvlmc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/geodist" class="external-link">geodist</a></span><span class="op">)</span> <span class="co">## used in the earth quake example</span></span></code></pre></div>
<p>Most of the theoretical papers on Variable Length Markov Chains
(VLMC, see <code><a href="../articles/variable-length-markov-chains.html">vignette("variable-length-markov-chains")</a></code>) focus
on time series indexed by <span class="math inline">\(\mathbb{Z}\)</span> which simplifies the analysis.
In practice time series are obviously finite which introduces some
difficulties associated to the initial observations. In particular, the
definition of a likelihood function is not entirely obvious.</p>
<div class="section level2">
<h2 id="likelihood-functions-for-markov-chains">Likelihood functions for Markov chains<a class="anchor" aria-label="anchor" href="#likelihood-functions-for-markov-chains"></a>
</h2>
<p>Let us consider a doubly infinite time series <span class="math inline">\(X_{i\in\mathbb{Z}}\)</span> generated by some
model <span class="math inline">\(\mathcal{M}\)</span>. The likelihood
function associated to a finite observation of the time series, <span class="math inline">\((x_i)_{1\leq i\leq n}\)</span>, is <span class="math inline">\(\mathbb{P}_{\mathcal{M}}(X_1=x_1,\ldots,X_n=x_n)\)</span>.</p>
<p>If <span class="math inline">\(\mathcal{M}\)</span> is a Markov chain
of order <span class="math inline">\(d\)</span>, then we have <span class="math display">\[
\mathbb{P}_{\mathcal{M}}(X_{d+1}=x_{d+1},\ldots,X_n=x_n)=\prod_{i=d+1}^n\mathbb{P}_{\mathcal{M}}(X_i=x_i|X_{i-1}=x_{i-1},\ldots,X_{i-d}=x_{i-d}).
\]</span> Thus if we know only <span class="math inline">\(x_{1\leq
i\leq n}\)</span> we can compute only the likelihood of <span class="math inline">\((x_i)_{d+1\leq i\leq n}\)</span>.</p>
<p>In practice, comparing models with different orders should be done
only using the likelihood functions based on the same subset of the
observed time series, i.e. using the highest order. As pointed out in
several papers this has no impact on asymptotic results (see e.g. <a href="https://dx.doi.org/10.1109/TIT.2006.881742" class="external-link">Garivier, A. (2006),
Consistency of the unlimited BIC context tree estimator. IEEE
Transactions on Information Theory, 52 (10) 4630–4635</a>).</p>
</div>
<div class="section level2">
<h2 id="likelihood-functions-for-vlmc">Likelihood functions for VLMC<a class="anchor" aria-label="anchor" href="#likelihood-functions-for-vlmc"></a>
</h2>
<div class="section level3">
<h3 id="truncated-solution">Truncated solution<a class="anchor" aria-label="anchor" href="#truncated-solution"></a>
</h3>
<p>The simplest way to define a likelihood function for a VLMC is to
consider it as a Markov chain of the order given by the length of its
longest context (i.e. of the order of the VLMC).</p>
</div>
<div class="section level3">
<h3 id="specific-contexts">Specific contexts<a class="anchor" aria-label="anchor" href="#specific-contexts"></a>
</h3>
<p>Another approach considers the fact that the past of <span class="math inline">\((x_i)_{1\leq i\leq n}\)</span> is unknown and
replace it by a collection of specific contexts that summarize this
unknown past. This is used in Garivier’s paper cited above. By
definition, each observation that does not have a actual context in the
VLMC appears only once and thus is perfectly predicted by the empirical
distribution associated to it. It has therefore a likelihood of 1. In
practice, this amounts to identifying <span class="math inline">\(\mathbb{P}_{\mathcal{M}}(X_1=x_1,\ldots,X_n=x_n)\)</span>
to <span class="math inline">\(\mathbb{P}_{\mathcal{M}}(X_{d+1}=x_{d+1},\ldots,X_n=x_n)\)</span>.</p>
<p>In terms of parameters for AIC/BIC calculation, this corresponds to
adding a specific distribution for each of the <span class="math inline">\(d\)</span> initial values, where <span class="math inline">\(d\)</span> is the order of the VLMC.</p>
</div>
<div class="section level3">
<h3 id="extended-contexts">Extended contexts<a class="anchor" aria-label="anchor" href="#extended-contexts"></a>
</h3>
<p>Another approach considers extended/approximate contexts for the
<span class="math inline">\(d\)</span> initial values. Indeed each
observation <span class="math inline">\(x_i\)</span> for <span class="math inline">\(1\leq i\leq d\)</span> can be considered has
having its context partially determined by <span class="math inline">\((x_1,\ldots, x_{i-1})\)</span> (thus by the empty
context for <span class="math inline">\(i=1\)</span>). Let us consider
for instance <span class="math inline">\(x_1\)</span> and the empty
context (the root of the context tree). If <span class="math inline">\(d\geq 1\)</span>, we cannot determine the context
of <span class="math inline">\(x_1\)</span> without values of <span class="math inline">\((x_{-d+1},\ldots, x_0)\)</span> even if the empty
context is a valid one. However, we can assign this empty context to
<span class="math inline">\(x_1\)</span> because of the lack of
information. More generally, we can traverse the context tree using as
many past values as available and stop in the corresponding node which
is then interpreted as a context using the frequencies collected during
the construction of the VLMC.</p>
<p>In terms of parameters, this adds to the VLMC an additional extended
context for each node of the context tree which is not a context.</p>
</div>
</div>
<div class="section level2">
<h2 id="complete-example">Complete example<a class="anchor" aria-label="anchor" href="#complete-example"></a>
</h2>
<p>Let us revisit the California earth quakes example proposed in
<code><a href="../articles/variable-length-markov-chains.html">vignette("variable-length-markov-chains")</a></code>. The model is
obtained as follows (see the vignette for details):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">California_centre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>longitude <span class="op">=</span> <span class="op">-</span><span class="fl">119.449444</span>, latitude <span class="op">=</span> <span class="fl">37.166111</span><span class="op">)</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geodist/man/geodist.html" class="external-link">geodist</a></span><span class="op">(</span><span class="va">globalearthquake</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">California_centre</span>,</span>
<span>  measure <span class="op">=</span> <span class="st">"geodesic"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">California_earth_quakes</span> <span class="op">&lt;-</span> <span class="va">globalearthquake</span><span class="op">[</span><span class="va">distances</span> <span class="op">&lt;</span> <span class="fl">2e6</span>, <span class="op">]</span> <span class="co">## distances are in meters</span></span>
<span><span class="va">California_weeks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">globalearthquake</span><span class="op">$</span><span class="va">nbweeks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">California_weeks</span><span class="op">[</span><span class="va">California_earth_quakes</span><span class="op">$</span><span class="va">nbweeks</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">California_weeks_earth_quakes_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">California_weeks</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">California_weeks_earth_quakes_model</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="va">model</span>, prob <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (5126, 1291)</span></span>
<span><span class="co">#&gt; +-- 0 (4185, 940)</span></span>
<span><span class="co">#&gt; |   +-- 0 (3460, 725)</span></span>
<span><span class="co">#&gt; |   |   '-- 0 (2883, 577)</span></span>
<span><span class="co">#&gt; |   |       '-- 0 (2421, 462)</span></span>
<span><span class="co">#&gt; |   |           '-- 1 (358, 103)</span></span>
<span><span class="co">#&gt; |   '-- 1 (724, 215)</span></span>
<span><span class="co">#&gt; '-- 1 (940, 351)</span></span></code></pre></div>
<p>The optimal model according to the BIC as an order of 5 and thus the
simple truncated log likelihood is obtained by considering only the
observations starting at index 6. We disregard the first 5 observations,
i.e.:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">California_weeks</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0</span></span></code></pre></div>
<p>The corresponding log likelihood is</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loglikelihood.html">loglikelihood</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -3182.077 (df= 6, nb obs.= 6412, initial="truncated")</span></span></code></pre></div>
<p>Using specific contexts amounts to assuming perfect predictions for
the first five observations. The log likelihood is not modified, but it
covers now the full time series, i.e. 6417 observations. The number of
parameters is increased significantly as each of the 5 initial values is
associated to a full conditional distribution leading to a total of 11
parameters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loglikelihood.html">loglikelihood</a></span><span class="op">(</span><span class="va">model</span>, initial <span class="op">=</span> <span class="st">"specific"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -3182.077 (df= 11, nb obs.= 6417, initial="specific")</span></span></code></pre></div>
<p>The extended context approach is the most complex. For the first
observation, we use the empty context, i.e. the root of the context
tree. The associated empirical distribution is <span class="math inline">\(\mathbb{P}(X_1=1)=\frac{1291}{5126+1291}\simeq0.201\)</span>.
Its contribution to the log likelihood is therefore <span class="math inline">\(\log \mathbb{P}(X_1=0)\simeq -0.225\)</span> as
the first observation is equal to 0.</p>
<p>As the root node is not a proper context, the specification of its
associated empirical distribution contributes to the total number of
parameters of the model (i.e. it adds a parameter to the total).</p>
<p>For the second observation, <span class="math inline">\(X_2=0\)</span>, the candidate context is <span class="math inline">\(0\)</span>. However, <span class="math inline">\(0\)</span> is again not a proper context we should
normally look for <span class="math inline">\(X_{0}\)</span> and older
values to find a proper context. In the extended approach, we consider
the empirical distribution of values following a 0 in the time series,
which is given by <span class="math inline">\(\mathbb{P}(X_1=1)=\frac{940}{4185+940}\simeq0.183\)</span>.
The contribution of this observation to the log likelihood is therefore
<span class="math inline">\(\log \mathbb{P}(X_1=0)\simeq
-0.203\)</span>. In addition, this extended context adds again a
parameter to the total.</p>
<p>The following observations <span class="math inline">\(X_3\)</span>,
<span class="math inline">\(X_4\)</span> and <span class="math inline">\(X_5\)</span> have all proper contexts and
contribute in a normal way to the (log) likelihood without the need for
additional parameters. Notice that the number of additional parameters
does not depend on the initial sequence but on the structure of the
context tree. Notice also that while the corresponding nodes are
contexts, they are not the contexts of those three values. Those
contexts cannot be computed due to the lack of older values.</p>
<p>The final value is</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loglikelihood.html">loglikelihood</a></span><span class="op">(</span><span class="va">model</span>, initial <span class="op">=</span> <span class="st">"extended"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -3183.052 (df= 8, nb obs.= 6417, initial="extended")</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://fabrice-rossi.github.io/" class="external-link">Fabrice Rossi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
