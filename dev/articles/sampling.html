<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mixvlmc">
<title>Sampling from (CO)VLMC • mixvlmc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sampling from (CO)VLMC">
<meta property="og:description" content="mixvlmc">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mixvlmc</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/context-trees.html">Context trees</a>
    <a class="dropdown-item" href="../articles/covlmc.html">Variable Length Markov Chains with Covariates (COVLMC)</a>
    <a class="dropdown-item" href="../articles/sampling.html">Sampling from (CO)VLMC</a>
    <a class="dropdown-item" href="../articles/variable-length-markov-chains.html">Variable length Markov chains (VLMC)</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/mixvlmc-0-1.html">mixvlmc 0.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fabrice-rossi/mixvlmc/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Sampling from (CO)VLMC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fabrice-rossi/mixvlmc/blob/HEAD/vignettes/sampling.Rmd" class="external-link"><code>vignettes/sampling.Rmd</code></a></small>
      <div class="d-none name"><code>sampling.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fabrice-rossi/mixvlmc" class="external-link">mixvlmc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co">## for frollapply</span></span></code></pre></div>
<p>Once a (CO)VLMC has been estimated from a sequence, it can be used to
produce new sequences. Any statistical estimator defined on the original
sequence can be applied to the simulated sequences leading a form of <a href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)" class="external-link">semi-parametric
bootstrap</a>. This provides an interesting alternative to other
bootstrapping solutions for correlated data, such as the block
bootstrap. This can also be use to consider what-if scenarios when
different values of the covariates are used study their effect beyond
analysis coefficients in context specific models.</p>
<div class="section level2">
<h2 id="theoretical-results">Theoretical results<a class="anchor" aria-label="anchor" href="#theoretical-results"></a>
</h2>
<p>Bühlmann and Wyner show in <a href="https://dx.doi.org/10.1214/aos/1018031204" class="external-link">their paper</a> that
this approach is consistent for statistics that depend smoothly from
arbitrary means of fixed mappings of contexts to numerical values. In
simple terms, one can first choose a mapping of arbitrary tuples of
values in the state space to numerical vectors and then build a
estimator by averaging those vectors over the observed sequence. The
resulting vector mean can then be transformed smoothly to lead to an
estimator. The VLMC bootstrap is then consistent for this estimator
under relatively mild hypothesis on the underlying VLMC.</p>
<p>A typical example of such estimator is the probability of observing a
fixed pattern in the sequence. More generally, the class of estimators
includes smooth transformations of the empirical distribution of
patterns up to a fixed length.</p>
<p>In practice, it is recommended to sample a longer sequence than the
one needed and to keep only the last <span class="math inline">\(n\)</span> values, in order to minimise the
influence of the starting values.</p>
</div>
<div class="section level2">
<h2 id="sampling-from-a-vlmc">Sampling from a VLMC<a class="anchor" aria-label="anchor" href="#sampling-from-a-vlmc"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Let us consider a simple example with an independent sample:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">500</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The optimal VLMC according to the BIC has non memory:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_vlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">dts</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">best_vlmc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (0.508, 0.492)</span></span></code></pre></div>
<p>Simulating a sequence using the model is done via the standard
<code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">stats::simulate()</a></code> function as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dts_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">best_vlmc</span><span class="op">)</span>, <span class="fl">600</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Even if this is useless here because of the independence, we drop the
first 100 samples. In general <code><a href="../reference/simulate.vlmc.html">simulate.vlmc()</a></code> is used as
<code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">stats::simulate()</a></code> and supports the standard parameters:</p>
<ul>
<li>
<code>nsim</code> for the number of simulated values, here the
length of the new time series</li>
<li>
<code>seed</code> to specify the random seed used during the
simulation (the initial state of the random number generator is restored
to its previous after simulating the values)</li>
</ul>
<p>In addition, one can specify the initial values of the sequence via
the <code>init</code> parameter, for instance:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dts_sample_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">best_vlmc</span><span class="op">)</span>, <span class="fl">10</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fl">0L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>is guaranteed to start with <span class="math inline">\(0,
0\)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dts_sample_2</span></span>
<span><span class="co">#&gt;  [1] 0 0 0 0 0 1 1 0 1 0</span></span></code></pre></div>
<p>This provides an alternative to dropping the initial values of the
simulated time series by setting those values to the one observed in the
data set. Notice that this practice has no theoretical
justification.</p>
</div>
<div class="section level3">
<h3 id="cac-time-series">CAC time series<a class="anchor" aria-label="anchor" href="#cac-time-series"></a>
</h3>
<p>Let us consider the French CAC index provided in
<code>EuStockMarkets</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span><span class="op">$</span><span class="va">CAC</span></span></code></pre></div>
<p>We turn it into a discrete time series with three values:</p>
<ul>
<li>Stay if the value of the index on day t+1 is between 99.5% and
100.5% of the value on day t</li>
<li>Up if the value increased by at least 0.5%</li>
<li>Down if the value decreased by at least 0.5%</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_rel_evol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">CAC_raw</span><span class="op">)</span> <span class="op">/</span> <span class="va">CAC_raw</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">CAC_raw</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">CAC_dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CAC_rel_evol</span> <span class="op">&gt;=</span> <span class="fl">0.005</span>, <span class="st">"Up"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CAC_rel_evol</span> <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">0.005</span>, <span class="st">"Down"</span>, <span class="st">"Stay"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Down"</span>, <span class="st">"Stay"</span>, <span class="st">"Up"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we adjust a VLMC to the time series using the AIC criterion:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_vlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">CAC_dts</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">CAC_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">CAC_vlmc</span><span class="op">)</span></span></code></pre></div>
<p>We use here the AIC to favour predictive performances and as a
consequence the obtained model is quite complex with 30 contexts.</p>
<p>The original discrete time series does not exhibit long subsequences
of constant values as shown in the following graphical
representation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_rle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">CAC_dts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CAC_rle_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">CAC_rle</span><span class="op">$</span><span class="va">values</span>, length <span class="op">=</span> <span class="va">CAC_rle</span><span class="op">$</span><span class="va">lengths</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">CAC_rle_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Distribution of the lengths of constant subsequences"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Length"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Count"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<p>To study this aspect of the time series, a natural statistics is the
probability of observing a constant subsequence of a length between 5
and 10 among all subsequences of length 10 that can be generated by the
model. Notice that the patterns used in the statistics must be of fixed
lengths to be covered by the consistency theorems mentioned above. We
implement the statistics as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">long_sequence</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dts_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">dts</span><span class="op">)</span></span>
<span>  <span class="co">## RLE cannot be used directly as we need to account for overlapping</span></span>
<span>  <span class="co">## patterns</span></span>
<span>  <span class="va">dts_freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/froll.html" class="external-link">frollapply</a></span><span class="op">(</span><span class="va">dts_int</span>, <span class="fl">10</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">length</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dts_freq</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We generate 100 bootstrap samples, using a burning time proportional
to the depth of the model, in order to allow for a proper mixing to take
place. We use the <code>seed</code> parameter of
<code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">stats::simulate()</a></code> to ensure reproducibility.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="fl">100</span>, mode <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span>
<span><span class="va">burning_time</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="op">*</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">CAC_model</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">bootstrap_samples</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bootstrap_samples</span><span class="op">[[</span><span class="va">b</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">CAC_model</span>,</span>
<span>    <span class="va">burning_time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">CAC_dts</span><span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="va">b</span></span>
<span>  <span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burning_time</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then we compute the statistics on the bootstrap samples.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">bootstrap_samples</span>, <span class="va">long_sequence</span><span class="op">)</span></span></code></pre></div>
<p>The bootstrap distribution of this statistics is illustrated on the
following figure in which the red vertical line represents the value of
the statistics on the original sequence.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bootstrap_ls</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Bootstrap distribution of the probability of long constant subsequences"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Probability"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu">long_sequence</span><span class="op">(</span><span class="va">CAC_dts</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="sampling-from-a-covlmc">Sampling from a COVLMC<a class="anchor" aria-label="anchor" href="#sampling-from-a-covlmc"></a>
</h2>
<p>The case of COVLMC is more complex mainly because of the dependence
towards an external time series that is not modelled. In addition, no
theoretical result justify a form of COVLMC bootstrap at the time of
writing this document (2023).</p>
<p>We can nevertheless use sampling both to get an idea of the potential
variability of the results from a qualitative point of view, and also to
study some what-if scenarios based on a modification of the
covariates.</p>
<div class="section level3">
<h3 id="cac-example-continued">CAC example continued<a class="anchor" aria-label="anchor" href="#cac-example-continued"></a>
</h3>
<p>Let us study the CAC discrete time series using the three other
indexes from <code>EuStockMarkets</code> as covariates. As previously,
we select a model with the AIC criterion:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DAX"</span>, <span class="st">"SMI"</span>, <span class="st">"FTSE"</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">CAC_covlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_covlmc.html">tune_covlmc</a></span><span class="op">(</span><span class="va">CAC_dts</span>, <span class="va">CAC_covariates</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">CAC_comodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_covlmc.html">as_covlmc</a></span><span class="op">(</span><span class="va">CAC_covlmc</span><span class="op">)</span></span></code></pre></div>
<p>The obtained model is relatively complex as shown below:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="va">CAC_comodel</span>, model <span class="op">=</span> <span class="st">"full"</span>, with_state <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; *</span></span>
<span><span class="co">#&gt; +-- Down</span></span>
<span><span class="co">#&gt; |   +-- Down (0.04097 [ (Down) | (I)    DAX_1   SMI_1    FTSE_1    DAX_2    SMI_2   FTSE_2  </span></span>
<span><span class="co">#&gt; |   |                   Stay   | -2.383 0.01467 -0.01714 -0.003948 -0.01314 0.01539 0.005337</span></span>
<span><span class="co">#&gt; |   |                   Up     | -1.939 0.02377 -0.02597 -0.0104   -0.02428 0.02526 0.01193  ])</span></span>
<span><span class="co">#&gt; |   '-- Stay, Up (0.07236 [ (Down) | (I)    DAX_1     SMI_1     FTSE_1    </span></span>
<span><span class="co">#&gt; |                           Stay   | -1.412 0.0004292 -0.001297 0.001371  </span></span>
<span><span class="co">#&gt; |                           Up     | 1.59   -0.000136 0.0004101 -0.0007633 ])</span></span>
<span><span class="co">#&gt; '-- Stay</span></span>
<span><span class="co">#&gt; |   +-- Stay (0.0065 [ (Down) | (I)   DAX_1     SMI_1     FTSE_1  DAX_2     SMI_2    FTSE_2  </span></span>
<span><span class="co">#&gt; |   |                  Stay   | 0.871 0.007903  -0.009399 0.01673 -0.007771 0.009261 -0.01684</span></span>
<span><span class="co">#&gt; |   |                  Up     | 2.838 -0.005994 -0.01448  0.0299  0.003666  0.0169   -0.03126 ])</span></span>
<span><span class="co">#&gt; |   '-- Down, Up (0.002452 [ (Down) | (I)    DAX_1     SMI_1     FTSE_1   </span></span>
<span><span class="co">#&gt; |                            Stay   | -1.707 -0.001755 0.0004276 0.001412 </span></span>
<span><span class="co">#&gt; |                            Up     | -1.397 -0.001357 0.0006376 0.0008178 ])</span></span>
<span><span class="co">#&gt; '-- Up</span></span>
<span><span class="co">#&gt;     +-- Up (0.01046 [ (Down) | (I)     DAX_1    SMI_1    FTSE_1    DAX_2     SMI_2   FTSE_2  </span></span>
<span><span class="co">#&gt;     |                 Stay   | -0.4838 0.02407  -0.02501 -0.008507 -0.02374  0.02474 0.0089  </span></span>
<span><span class="co">#&gt;     |                 Up     | 2.484   0.005797 -0.01774 -0.009711 -0.006469 0.01917 0.008314 ])</span></span>
<span><span class="co">#&gt;     '-- Down, Stay (0.7881 [ (Down) | (I)   </span></span>
<span><span class="co">#&gt;                              Stay   | 0.3225</span></span>
<span><span class="co">#&gt;                              Up     | 0.1779 ])</span></span></code></pre></div>
<p>The variability of the discrete time series for fixed values of the
covariates can be investigated using simulated sequences. The only
difference between <code><a href="../reference/simulate.vlmc.html">simulate.vlmc()</a></code> and
<code><a href="../reference/simulate.covlmc.html">simulate.covlmc()</a></code> is the need for the covariates in the
latter. A burning time is also problematic here as we do not have
additional throw away values for the covariates. A possibility used here
consists in starting the discrete time series as the observed one
started, using as many values as the size of the largest context. Notice
that in the current implementation, simulating from a COVLMC is
relatively slow compared to simulation from a VLMC. Here we perform a
single simulation to illustrate the feature.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">co_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">CAC_comodel</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">CAC_dts</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  init <span class="op">=</span> <span class="va">CAC_dts</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">CAC_comodel</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  covariate <span class="op">=</span> <span class="va">CAC_covariates</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-if-scenarios">What-if scenarios<a class="anchor" aria-label="anchor" href="#what-if-scenarios"></a>
</h3>
<p>In some situations, one can modify the covariates to test the
consequences of the external influence on the discrete time series under
study. Let us consider for instance a week of electrical
consumption:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pc_week</span> <span class="op">&lt;-</span> <span class="va">powerconsumption</span><span class="op">[</span><span class="va">powerconsumption</span><span class="op">$</span><span class="va">week</span> <span class="op">==</span> <span class="fl">12</span>, <span class="op">]</span></span>
<span><span class="va">elec</span> <span class="op">&lt;-</span> <span class="va">pc_week</span><span class="op">$</span><span class="va">active_power</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pc_week</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_time</span>, y <span class="op">=</span> <span class="va">active_power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Activer power (kW)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;">
We build a discrete version by considering two states: the background
base active power below 0.4 kW and the active use of electric appliance
above this limit.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec_dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">elec</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.2</span>, <span class="fl">8</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"background"</span>, <span class="st">"active"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">elec_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>day <span class="op">=</span> <span class="op">(</span><span class="va">pc_week</span><span class="op">$</span><span class="va">hour</span> <span class="op">&gt;=</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">pc_week</span><span class="op">$</span><span class="va">hour</span> <span class="op">&lt;=</span> <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we adjust a COVLMC with a binary covariate day/night, using the
AIC.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec_covlmc_tune</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_covlmc.html">tune_covlmc</a></span><span class="op">(</span><span class="va">elec_dts</span>, <span class="va">elec_cov</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">best_elec_covlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_covlmc.html">as_covlmc</a></span><span class="op">(</span><span class="va">elec_covlmc_tune</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="va">best_elec_covlmc</span>, model <span class="op">=</span> <span class="st">"full"</span>, time_sep <span class="op">=</span> <span class="st">" | "</span>, p_value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; *</span></span>
<span><span class="co">#&gt; +-- background</span></span>
<span><span class="co">#&gt; |   +-- background ([ (I)    | day_1TRUE</span></span>
<span><span class="co">#&gt; |   |                 -3.383 | 0.8979    ])</span></span>
<span><span class="co">#&gt; |   '-- active ([ (I)   </span></span>
<span><span class="co">#&gt; |                 -1.526 ])</span></span>
<span><span class="co">#&gt; '-- active</span></span>
<span><span class="co">#&gt;     +-- background ([ (I)   | day_1TRUE</span></span>
<span><span class="co">#&gt;     |                 20.57 | -19.36    ])</span></span>
<span><span class="co">#&gt;     '-- active</span></span>
<span><span class="co">#&gt;         +-- background ([ (I)  </span></span>
<span><span class="co">#&gt;         |                 1.609 ])</span></span>
<span><span class="co">#&gt;         '-- active ([ (I)   | day_1TRUE</span></span>
<span><span class="co">#&gt;                       2.552 | 0.8602    ])</span></span></code></pre></div>
<p>Then we can simulate longer or shorter days by manipulating the
covariates. For instance a “day only” full week could be obtained as
follows</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">day_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">best_elec_covlmc</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">elec_dts</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  covariate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">elec_dts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>while a “night only” full week is given by</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">night_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">best_elec_covlmc</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">elec_dts</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  covariate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">elec_dts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A typical use of this approach consists in simulating first a
collection of sequences with the original covariates to get a sense of
the variability of the statistics of interest. In a second phase, a
comparable collection of sequences is generated using the manipulated
covariates.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Fabrice Rossi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
