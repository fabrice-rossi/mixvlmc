<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mixvlmc">
<title>Sampling from (CO)VLMC • mixvlmc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sampling from (CO)VLMC">
<meta property="og:description" content="mixvlmc">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mixvlmc</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/context-trees.html">Context trees</a>
    <a class="dropdown-item" href="../articles/variable-length-markov-chains.html">Variable length Markov chains (VLMC)</a>
    <a class="dropdown-item" href="../articles/covlmc.html">Variable Length Markov Chains with Covariates (COVLMC)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced topics</h6>
    <a class="dropdown-item" href="../articles/likelihood.html">Likelihood calculation</a>
    <a class="dropdown-item" href="../articles/sampling.html">Sampling from (CO)VLMC</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/mixvlmc-0-1.html">mixvlmc 0.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fabrice-rossi/mixvlmc/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Sampling from (CO)VLMC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fabrice-rossi/mixvlmc/blob/HEAD/vignettes/sampling.Rmd" class="external-link"><code>vignettes/sampling.Rmd</code></a></small>
      <div class="d-none name"><code>sampling.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fabrice-rossi/mixvlmc" class="external-link">mixvlmc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co">## for frollapply</span></span></code></pre></div>
<p>Once a (CO)VLMC has been estimated from a sequence, it can be used to
produce new sequences. Any statistical estimator defined on the original
sequence can be applied to the simulated sequences leading a form of <a href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)" class="external-link">semi-parametric
bootstrap</a>. This provides an interesting alternative to other
bootstrapping solutions for correlated data, such as the block
bootstrap. This can also be use to consider what-if scenarios when
different values of the covariates are used study their effect beyond
analysis coefficients in context specific models.</p>
<div class="section level2">
<h2 id="theoretical-results">Theoretical results<a class="anchor" aria-label="anchor" href="#theoretical-results"></a>
</h2>
<p>Bühlmann and Wyner show in <a href="https://dx.doi.org/10.1214/aos/1018031204" class="external-link">their paper</a> that
this approach is consistent for statistics that depend smoothly from
arbitrary means of fixed mappings of contexts to numerical values. In
simple terms, one can first choose a mapping of arbitrary tuples of
values in the state space to numerical vectors and then build a
estimator by averaging those vectors over the observed sequence. The
resulting vector mean can then be transformed smoothly to lead to an
estimator. The VLMC bootstrap is then consistent for this estimator
under relatively mild hypothesis on the underlying VLMC.</p>
<p>A typical example of such estimator is the probability of observing a
fixed pattern in the sequence. More generally, the class of estimators
includes smooth transformations of the empirical distribution of
patterns up to a fixed length.</p>
<p>In practice, it is recommended to sample a longer sequence than the
one needed and to keep only the last <span class="math inline">\(n\)</span> values, in order to minimise the
influence of the starting values.</p>
</div>
<div class="section level2">
<h2 id="sampling-from-a-vlmc">Sampling from a VLMC<a class="anchor" aria-label="anchor" href="#sampling-from-a-vlmc"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Let us consider a simple example with an independent sample:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">500</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The optimal VLMC according to the BIC has non memory:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_vlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">dts</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">best_vlmc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (0.522, 0.478)</span></span></code></pre></div>
<p>Simulating a sequence using the model is done via the standard
<code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">stats::simulate()</a></code> function as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dts_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">best_vlmc</span><span class="op">)</span>, <span class="fl">600</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Even if this is useless here because of the independence, we drop the
first 100 samples. In general <code><a href="../reference/simulate.vlmc.html">simulate.vlmc()</a></code> is used as
<code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">stats::simulate()</a></code> and supports the standard parameters:</p>
<ul>
<li>
<code>nsim</code> for the number of simulated values, here the
length of the new time series</li>
<li>
<code>seed</code> to specify the random seed used during the
simulation (the initial state of the random number generator is restored
to its previous after simulating the values)</li>
</ul>
<p>In addition, one can specify the initial values of the sequence via
the <code>init</code> parameter, for instance:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dts_sample_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">best_vlmc</span><span class="op">)</span>, <span class="fl">10</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fl">0L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>is guaranteed to start with <span class="math inline">\(0,
0\)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dts_sample_2</span></span>
<span><span class="co">#&gt;  [1] 0 0 1 1 0 0 0 0 0 0</span></span>
<span><span class="co">#&gt; attr(,"seed")</span></span>
<span><span class="co">#&gt;   [1]       10403         500   497598969 -1432522424  1631743094   517052849</span></span>
<span><span class="co">#&gt;   [7]   308340707  1528353970  -256902908   448954951  -786258659  -319495276</span></span>
<span><span class="co">#&gt;  [13] -1789446342  1184750469  -673050529    59667174  1595873648  -659168621</span></span>
<span><span class="co">#&gt;  [19] -1986299087   383805920  1419783806  -615434999  -429463749  -317202678</span></span>
<span><span class="co">#&gt;  [25]   736116460  1681804143 -1241670491   893386332  1582560818  -514439891</span></span>
<span><span class="co">#&gt;  [31]   719262695  -822242546  -410200856  2092420843 -2006360183   -53396712</span></span>
<span><span class="co">#&gt;  [37] -1116606906 -1552998751 -1375010509   394350754 -1761042540  -705802729</span></span>
<span><span class="co">#&gt;  [43] -1584375283 -1135980764  -854754550   433141365 -1546492465  1445023446</span></span>
<span><span class="co">#&gt;  [49]   748548736   744512707  -685630879 -2104159536  -913497042   555502041</span></span>
<span><span class="co">#&gt;  [55] -1121765909 -1442275238  -256716260  -726662369  1886951285  -835158516</span></span>
<span><span class="co">#&gt;  [61]  2042841058 -1459991363  -438924489  -160255010  -347934440  1031533691</span></span>
<span><span class="co">#&gt;  [67]   541133337 -1313768792  1781076054 -1715532591   802773123  -337523950</span></span>
<span><span class="co">#&gt;  [73] -1275621724   969284199  -500059203   920309044  1162520218    31479013</span></span>
<span><span class="co">#&gt;  [79]  1521919615  1510707206  -765439088   948141619  1660947921  -956633216</span></span>
<span><span class="co">#&gt;  [85] -1504443810   900864425  2069149787     5750890  1115222284  1307749199</span></span>
<span><span class="co">#&gt;  [91] -2114349051   231360188 -1518280814 -1790268275  -312730937 -1020322898</span></span>
<span><span class="co">#&gt;  [97]  1044256264  -748991989  1678469865  -240470600 -1157975450 -2107916543</span></span>
<span><span class="co">#&gt; [103] -1711588973  1658753602 -1681058316 -1303343113  -280603667   299842692</span></span>
<span><span class="co">#&gt; [109] -1544600918 -1315096555  -173113169   851742390  -577291040   530268195</span></span>
<span><span class="co">#&gt; [115] -2038055103 -1062403536 -1521663922  1408368825 -1902930741   796187002</span></span>
<span><span class="co">#&gt; [121]  1653793916  1780109503   945542549  1553139116  1482637186    97748317</span></span>
<span><span class="co">#&gt; [127] -1801167785   555776830 -1557773448 -1651355557   115775417 -1849530872</span></span>
<span><span class="co">#&gt; [133]  -578874186 -1293397007   813776419 -1577918862   330425540  -847367545</span></span>
<span><span class="co">#&gt; [139]   631089757  1239608404  -949803398  1348801989 -1167206625  1173025446</span></span>
<span><span class="co">#&gt; [145]   768324656 -1669994797  -830733071   948715552  -299256130 -1550548279</span></span>
<span><span class="co">#&gt; [151] -1954695045  -528607670   490721964   622241199   692774245  -308374756</span></span>
<span><span class="co">#&gt; [157]  1716221810 -1436627987  -933897177   855942222  1370876072 -1185839445</span></span>
<span><span class="co">#&gt; [163] -1956744247  -995766312 -1816934778  1930805089 -1638665485   -54309534</span></span>
<span><span class="co">#&gt; [169] -1138480172  1450610391  1597994189  1194972260  1699084874  -256745547</span></span>
<span><span class="co">#&gt; [175]   573129487  -688685034 -1614902592   645835907   845314209   -91705712</span></span>
<span><span class="co">#&gt; [181]   835554670  -985031911   177790891   233504154   806299996 -1351090081</span></span>
<span><span class="co">#&gt; [187]   229339189  -227998772   408717090    27392381  2027303543  1195510686</span></span>
<span><span class="co">#&gt; [193]  2067413592  -826330181  -179628711 -1614663960  1875496726  1003683985</span></span>
<span><span class="co">#&gt; [199] -2147189437  -513570734  -312345884  -303309529   -72055427 -1445819276</span></span>
<span><span class="co">#&gt; [205]  1728550490  -834973019   540866751  -339375290  2038774224 -1080718349</span></span>
<span><span class="co">#&gt; [211]  -183012591  1567048512   -20640994   937776105  1969994011   977261354</span></span>
<span><span class="co">#&gt; [217]  1779373132  1769364495  1467750213 -2111913732  -896684206   906404045</span></span>
<span><span class="co">#&gt; [223]  2031128711 -1398942866 -1618188984 -1256304309  1619748009  2055910904</span></span>
<span><span class="co">#&gt; [229] -1163264730   694071682   773624040   282808556 -1145409476   302698610</span></span>
<span><span class="co">#&gt; [235] -1285441424  -858277340 -1994632648 -1609129446  1744283856 -1615997380</span></span>
<span><span class="co">#&gt; [241]  -154397548 -1340783486    -4329536  1622009148   349353616  -141652958</span></span>
<span><span class="co">#&gt; [247] -1008924664  1196422284    41621532 -1646213998  1778142336   820255764</span></span>
<span><span class="co">#&gt; [253]  -969383128  -722080710   -30536496  1454910572  1091327668  1449312274</span></span>
<span><span class="co">#&gt; [259]   206442464 -2049002548  -136178208 -1753940958   711931176  -427204340</span></span>
<span><span class="co">#&gt; [265]  1862020668  -935291662 -1737795344 -1737300156  1524871256 -1805804998</span></span>
<span><span class="co">#&gt; [271]   771639536 -2038902084 -1873501676  -210699070 -1573992864  1234367868</span></span>
<span><span class="co">#&gt; [277]  -855253808   -57349086  1507473576  -648675956 -1572767300  -744540110</span></span>
<span><span class="co">#&gt; [283]   874777408  -643164492  1656926536   153477818   865146640   514754796</span></span>
<span><span class="co">#&gt; [289]    74610772 -2029932782  1480118688 -1667977268 -1673660576  1772774594</span></span>
<span><span class="co">#&gt; [295]  1035611688    20916652   454009660  1155552114  1020507952  -578090972</span></span>
<span><span class="co">#&gt; [301]  -205349320 -1312775462  -393848944  1245932796  -865294956  2086294338</span></span>
<span><span class="co">#&gt; [307] -1435346432 -1080707012 -1759856048  1763999906  1477788488 -1966984692</span></span>
<span><span class="co">#&gt; [313] -1448054052  1238411346  -507167616   937152340  -389971992  -438596870</span></span>
<span><span class="co">#&gt; [319]  -369238192  -866139092   999145844 -1316383086   558963296   673527948</span></span>
<span><span class="co">#&gt; [325]   167184736  1528871138  1231996072 -2107339060   119945724 -1438276686</span></span>
<span><span class="co">#&gt; [331] -1941947408  -534283836  1698639192  -105928326   -42346064  -821296708</span></span>
<span><span class="co">#&gt; [337]  1475305044 -1655903806 -1915106528  -809198660 -1790230448 -1867578398</span></span>
<span><span class="co">#&gt; [343]  1909843816 -1902207156 -1291575556 -1057374478  -283255552   480081012</span></span>
<span><span class="co">#&gt; [349]    -2335224   133799354 -1084848688  1781858284 -2052613228 -1084141358</span></span>
<span><span class="co">#&gt; [355]  -489026464  -752183988  1942407968   676092546   279413224 -1455193108</span></span>
<span><span class="co">#&gt; [361]   342763068  1525251698   971699056    58838308   115829304  1436144026</span></span>
<span><span class="co">#&gt; [367] -1186110000 -1790102084 -1329510764 -1595727230 -1603082816   769625916</span></span>
<span><span class="co">#&gt; [373]   390312592 -1125546206   -54807032 -2028711156   712035228 -2071469038</span></span>
<span><span class="co">#&gt; [379]  1742795648  1760979732 -1230109400   962654266  1588712400  1601489516</span></span>
<span><span class="co">#&gt; [385]   580160564 -1629194094   -60882592  2132983116   875130336  -446032990</span></span>
<span><span class="co">#&gt; [391]  1424808872 -1339126644 -1579301956 -1584264078    51226608 -2053270460</span></span>
<span><span class="co">#&gt; [397] -1485404072  1773396026  -114577296   659801660   552371988  1742199490</span></span>
<span><span class="co">#&gt; [403]  1535550176  -996332420 -1900671792   441621410  1848634920   609077516</span></span>
<span><span class="co">#&gt; [409]   600872892     5798194 -1615437632   909283892   724298440  1303251642</span></span>
<span><span class="co">#&gt; [415]   759878800   349935340 -1384645036   309421714 -1569118432  1268553676</span></span>
<span><span class="co">#&gt; [421]   241828064 -1931501886   879703080  1302698924 -2028143940  -363615758</span></span>
<span><span class="co">#&gt; [427]   179861040 -1852647516   564400568  -595934374   792663184  1925196668</span></span>
<span><span class="co">#&gt; [433]    92309268   453094722   297111296  1156109244   382013264  -790648542</span></span>
<span><span class="co">#&gt; [439] -1955487160  -914100212  -146467748  1830990290 -1820303872  1691910484</span></span>
<span><span class="co">#&gt; [445]  -634228504   150757626   749070032  -622849748  -704257804  1134726546</span></span>
<span><span class="co">#&gt; [451]   480590176 -1800751092  1753826016  1377577570 -1552457048  -654554548</span></span>
<span><span class="co">#&gt; [457]  -536330049  1219056137  -192898274 -1343094068  -708289891 -1804323033</span></span>
<span><span class="co">#&gt; [463]  1715288400  -177027090  1860290715   933266173  1807444458 -2146233720</span></span>
<span><span class="co">#&gt; [469]  1662952497    -7043421  -582795612  1072480082  2120783527 -1681749263</span></span>
<span><span class="co">#&gt; [475]  -207830474  1735941844   269984357  1293631599 -1133456728 -1188585466</span></span>
<span><span class="co">#&gt; [481]   561773875  -504106603  -933900814   135246400 -1059533911  1833346587</span></span>
<span><span class="co">#&gt; [487]   307945452  -588814342   574487599   487128121   333647438  1591328412</span></span>
<span><span class="co">#&gt; [493]   373609485  -440063881  1905762432   567637726  1948446123   212229805</span></span>
<span><span class="co">#&gt; [499]  1551483674 -1657381928  1388652609 -1875880205 -1862371052  -384521054</span></span>
<span><span class="co">#&gt; [505]  1350732215  1980378497   796937094 -1234327100  1952874741   413217119</span></span>
<span><span class="co">#&gt; [511]  1684061112  1242279574  -274229085   178774629 -1756870782   794541296</span></span>
<span><span class="co">#&gt; [517]   706466969   713837707   643044732  -971344982  -930135073  1497614697</span></span>
<span><span class="co">#&gt; [523] -1406474882   771302764  -748454467   641162887   375900784 -1634807538</span></span>
<span><span class="co">#&gt; [529]  1570717243  -120959715 -1751337014 -1333174040 -1848601647  -167373373</span></span>
<span><span class="co">#&gt; [535]  1718537924   -42494606 -1009170361  1391721489   572341654 -1267711756</span></span>
<span><span class="co">#&gt; [541]  -683398523 -1721515057  -153941304  -615208090  1132941715 -1036723467</span></span>
<span><span class="co">#&gt; [547]   531665618   319405344  1077605641  1513501243 -2043713652  1787880986</span></span>
<span><span class="co">#&gt; [553] -1829372273   882301401  1307799150    33648124     9394029  -666582761</span></span>
<span><span class="co">#&gt; [559]   982412512  1726218942   125636747  -129569011  1982324538  1622947704</span></span>
<span><span class="co">#&gt; [565]  1997155617 -2010157613  1698508020  -910817918   277422103   725247713</span></span>
<span><span class="co">#&gt; [571]  1802600486  -902990556   361520597  -561675905 -1784266728 -1536311498</span></span>
<span><span class="co">#&gt; [577]  -907105853  -571037691 -1185821790  -341338224    79704889 -1774827541</span></span>
<span><span class="co">#&gt; [583]   649832668   599030026 -1068881921  1179249225   340750302  2035146636</span></span>
<span><span class="co">#&gt; [589]  -254988451  1571837799 -1047991152    15205038 -2018689189  -680521923</span></span>
<span><span class="co">#&gt; [595]   483143082 -1806261688  1358357105 -1157401629  -529580316   657327634</span></span>
<span><span class="co">#&gt; [601]  1801916903 -1412567631  1983134710  2040837652  1956591909    38117935</span></span>
<span><span class="co">#&gt; [607] -1379297304 -2048442170 -1337961101  1350155733  -194567758  2082275200</span></span>
<span><span class="co">#&gt; [613]   322175849 -2091972645  -254939348  1960485178   220119023  1585711737</span></span>
<span><span class="co">#&gt; [619]   323919118  -695880484  2145241933   775701175  1114968128  -161320674</span></span>
<span><span class="co">#&gt; [625]  -956204053  1861705811</span></span></code></pre></div>
<p>This provides an alternative to dropping the initial values of the
simulated time series by setting those values to the one observed in the
data set. Notice that this practice has no theoretical
justification.</p>
</div>
<div class="section level3">
<h3 id="cac-time-series">CAC time series<a class="anchor" aria-label="anchor" href="#cac-time-series"></a>
</h3>
<p>Let us consider the French CAC index provided in
<code>EuStockMarkets</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span><span class="op">$</span><span class="va">CAC</span></span></code></pre></div>
<p>We turn it into a discrete time series with three values:</p>
<ul>
<li>Stay if the value of the index on day t+1 is between 99.5% and
100.5% of the value on day t</li>
<li>Up if the value increased by at least 0.5%</li>
<li>Down if the value decreased by at least 0.5%</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_rel_evol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">CAC_raw</span><span class="op">)</span> <span class="op">/</span> <span class="va">CAC_raw</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">CAC_raw</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">CAC_dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CAC_rel_evol</span> <span class="op">&gt;=</span> <span class="fl">0.005</span>, <span class="st">"Up"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CAC_rel_evol</span> <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">0.005</span>, <span class="st">"Down"</span>, <span class="st">"Stay"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Down"</span>, <span class="st">"Stay"</span>, <span class="st">"Up"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then we adjust a VLMC to the time series using the AIC criterion:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_vlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">CAC_dts</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">CAC_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">CAC_vlmc</span><span class="op">)</span></span></code></pre></div>
<p>We use here the AIC to favour predictive performances and as a
consequence the obtained model is quite complex with 7 contexts.</p>
<p>The original discrete time series does not exhibit long subsequences
of constant values as shown in the following graphical
representation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_rle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">CAC_dts</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CAC_rle_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">CAC_rle</span><span class="op">$</span><span class="va">values</span>, length <span class="op">=</span> <span class="va">CAC_rle</span><span class="op">$</span><span class="va">lengths</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">CAC_rle_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Distribution of the lengths of constant subsequences"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Length"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Count"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<p>To study this aspect of the time series, a natural statistics is the
probability of observing a constant subsequence of a length between 5
and 10 among all subsequences of length 10 that can be generated by the
model. Notice that the patterns used in the statistics must be of fixed
lengths to be covered by the consistency theorems mentioned above. We
implement the statistics as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">long_sequence</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dts_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">dts</span><span class="op">)</span></span>
<span>  <span class="co">## RLE cannot be used directly as we need to account for overlapping</span></span>
<span>  <span class="co">## patterns</span></span>
<span>  <span class="va">dts_freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/froll.html" class="external-link">frollapply</a></span><span class="op">(</span><span class="va">dts_int</span>, <span class="fl">10</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">length</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dts_freq</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We generate 100 bootstrap samples, using a burning time proportional
to the depth of the model, in order to allow for a proper mixing to take
place. We use the <code>seed</code> parameter of
<code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">stats::simulate()</a></code> to ensure reproducibility.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="fl">100</span>, mode <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span>
<span><span class="va">burning_time</span> <span class="op">&lt;-</span> <span class="fl">50</span> <span class="op">*</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">CAC_model</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">bootstrap_samples</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bootstrap_samples</span><span class="op">[[</span><span class="va">b</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">CAC_model</span>,</span>
<span>    <span class="va">burning_time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">CAC_dts</span><span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="va">b</span></span>
<span>  <span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">burning_time</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then we compute the statistics on the bootstrap samples.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">bootstrap_samples</span>, <span class="va">long_sequence</span><span class="op">)</span></span></code></pre></div>
<p>The bootstrap distribution of this statistics is illustrated on the
following figure in which the red vertical line represents the value of
the statistics on the original sequence.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bootstrap_ls</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Bootstrap distribution of the probability of long constant subsequences"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Probability"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu">long_sequence</span><span class="op">(</span><span class="va">CAC_dts</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="sampling-from-a-covlmc">Sampling from a COVLMC<a class="anchor" aria-label="anchor" href="#sampling-from-a-covlmc"></a>
</h2>
<p>The case of COVLMC is more complex mainly because of the dependence
towards an external time series that is not modelled. In addition, no
theoretical result justify a form of COVLMC bootstrap at the time of
writing this document (2023).</p>
<p>We can nevertheless use sampling both to get an idea of the potential
variability of the results from a qualitative point of view, and also to
study some what-if scenarios based on a modification of the
covariates.</p>
<div class="section level3">
<h3 id="cac-example-continued">CAC example continued<a class="anchor" aria-label="anchor" href="#cac-example-continued"></a>
</h3>
<p>Let us study the CAC discrete time series using the three other
indexes from <code>EuStockMarkets</code> as covariates. As previously,
we select a model with the AIC criterion:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DAX"</span>, <span class="st">"SMI"</span>, <span class="st">"FTSE"</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">CAC_covlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_covlmc.html">tune_covlmc</a></span><span class="op">(</span><span class="va">CAC_dts</span>, <span class="va">CAC_covariates</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">CAC_comodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_covlmc.html">as_covlmc</a></span><span class="op">(</span><span class="va">CAC_covlmc</span><span class="op">)</span></span></code></pre></div>
<p>The obtained model is relatively complex as shown below:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="va">CAC_comodel</span>, model <span class="op">=</span> <span class="st">"full"</span>, with_state <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; *</span></span>
<span><span class="co">#&gt; +-- Down</span></span>
<span><span class="co">#&gt; |   +-- Down (0.04097 [ (Down) | (I)    DAX_1   SMI_1    FTSE_1    DAX_2    SMI_2   FTSE_2  </span></span>
<span><span class="co">#&gt; |   |                   Stay   | -2.383 0.01467 -0.01714 -0.003948 -0.01314 0.01539 0.005337</span></span>
<span><span class="co">#&gt; |   |                   Up     | -1.939 0.02377 -0.02597 -0.0104   -0.02428 0.02526 0.01193  ])</span></span>
<span><span class="co">#&gt; |   '-- Stay, Up (0.07236 [ (Down) | (I)    DAX_1     SMI_1     FTSE_1    </span></span>
<span><span class="co">#&gt; |                           Stay   | -1.412 0.0004292 -0.001297 0.001371  </span></span>
<span><span class="co">#&gt; |                           Up     | 1.59   -0.000136 0.0004101 -0.0007633 ])</span></span>
<span><span class="co">#&gt; '-- Stay</span></span>
<span><span class="co">#&gt; |   +-- Stay (0.0065 [ (Down) | (I)   DAX_1     SMI_1     FTSE_1  DAX_2     SMI_2    FTSE_2  </span></span>
<span><span class="co">#&gt; |   |                  Stay   | 0.871 0.007903  -0.009399 0.01673 -0.007771 0.009261 -0.01684</span></span>
<span><span class="co">#&gt; |   |                  Up     | 2.838 -0.005994 -0.01448  0.0299  0.003666  0.0169   -0.03126 ])</span></span>
<span><span class="co">#&gt; |   '-- Down, Up (0.002452 [ (Down) | (I)    DAX_1     SMI_1     FTSE_1   </span></span>
<span><span class="co">#&gt; |                            Stay   | -1.707 -0.001755 0.0004276 0.001412 </span></span>
<span><span class="co">#&gt; |                            Up     | -1.397 -0.001357 0.0006376 0.0008178 ])</span></span>
<span><span class="co">#&gt; '-- Up</span></span>
<span><span class="co">#&gt;     +-- Up (0.01046 [ (Down) | (I)     DAX_1    SMI_1    FTSE_1    DAX_2     SMI_2   FTSE_2  </span></span>
<span><span class="co">#&gt;     |                 Stay   | -0.4838 0.02407  -0.02501 -0.008507 -0.02374  0.02474 0.0089  </span></span>
<span><span class="co">#&gt;     |                 Up     | 2.484   0.005797 -0.01774 -0.009711 -0.006469 0.01917 0.008314 ])</span></span>
<span><span class="co">#&gt;     '-- Down, Stay (0.7881 [ (Down) | (I)   </span></span>
<span><span class="co">#&gt;                              Stay   | 0.3225</span></span>
<span><span class="co">#&gt;                              Up     | 0.1779 ])</span></span></code></pre></div>
<p>The variability of the discrete time series for fixed values of the
covariates can be investigated using simulated sequences. The only
difference between <code><a href="../reference/simulate.vlmc.html">simulate.vlmc()</a></code> and
<code><a href="../reference/simulate.covlmc.html">simulate.covlmc()</a></code> is the need for the covariates in the
latter. A burning time is also problematic here as we do not have
additional throw away values for the covariates. A possibility used here
consists in starting the discrete time series as the observed one
started, using as many values as the size of the largest context. Notice
that in the current implementation, simulating from a COVLMC is
relatively slow compared to simulation from a VLMC. Here we perform a
single simulation to illustrate the feature.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">co_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">CAC_comodel</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">CAC_dts</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  init <span class="op">=</span> <span class="va">CAC_dts</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">CAC_comodel</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  covariate <span class="op">=</span> <span class="va">CAC_covariates</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-if-scenarios">What-if scenarios<a class="anchor" aria-label="anchor" href="#what-if-scenarios"></a>
</h3>
<p>In some situations, one can modify the covariates to test the
consequences of the external influence on the discrete time series under
study. Let us consider for instance a week of electrical
consumption:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pc_week</span> <span class="op">&lt;-</span> <span class="va">powerconsumption</span><span class="op">[</span><span class="va">powerconsumption</span><span class="op">$</span><span class="va">week</span> <span class="op">==</span> <span class="fl">12</span>, <span class="op">]</span></span>
<span><span class="va">elec</span> <span class="op">&lt;-</span> <span class="va">pc_week</span><span class="op">$</span><span class="va">active_power</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pc_week</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_time</span>, y <span class="op">=</span> <span class="va">active_power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Activer power (kW)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sampling_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;">
We build a discrete version by considering two states: the background
base active power below 0.4 kW and the active use of electric appliance
above this limit.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec_dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">elec</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.2</span>, <span class="fl">8</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"background"</span>, <span class="st">"active"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">elec_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>day <span class="op">=</span> <span class="op">(</span><span class="va">pc_week</span><span class="op">$</span><span class="va">hour</span> <span class="op">&gt;=</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="va">pc_week</span><span class="op">$</span><span class="va">hour</span> <span class="op">&lt;=</span> <span class="fl">17</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we adjust a COVLMC with a binary covariate day/night, using the
AIC.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec_covlmc_tune</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_covlmc.html">tune_covlmc</a></span><span class="op">(</span><span class="va">elec_dts</span>, <span class="va">elec_cov</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">best_elec_covlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_covlmc.html">as_covlmc</a></span><span class="op">(</span><span class="va">elec_covlmc_tune</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="va">best_elec_covlmc</span>, model <span class="op">=</span> <span class="st">"full"</span>, time_sep <span class="op">=</span> <span class="st">" | "</span>, p_value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; *</span></span>
<span><span class="co">#&gt; +-- background</span></span>
<span><span class="co">#&gt; |   +-- background ([ (I)    | day_1TRUE</span></span>
<span><span class="co">#&gt; |   |                 -3.383 | 0.8979    ])</span></span>
<span><span class="co">#&gt; |   '-- active ([ (I)   </span></span>
<span><span class="co">#&gt; |                 -1.526 ])</span></span>
<span><span class="co">#&gt; '-- active</span></span>
<span><span class="co">#&gt;     +-- background ([ (I)   | day_1TRUE</span></span>
<span><span class="co">#&gt;     |                 20.57 | -19.36    ])</span></span>
<span><span class="co">#&gt;     '-- active</span></span>
<span><span class="co">#&gt;         +-- background ([ (I)  </span></span>
<span><span class="co">#&gt;         |                 1.609 ])</span></span>
<span><span class="co">#&gt;         '-- active ([ (I)   | day_1TRUE</span></span>
<span><span class="co">#&gt;                       2.552 | 0.8602    ])</span></span></code></pre></div>
<p>Then we can simulate longer or shorter days by manipulating the
covariates. For instance a “day only” full week could be obtained as
follows</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">day_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">best_elec_covlmc</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">elec_dts</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  covariate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">elec_dts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>while a “night only” full week is given by</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">night_only</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">best_elec_covlmc</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">elec_dts</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  covariate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">elec_dts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A typical use of this approach consists in simulating first a
collection of sequences with the original covariates to get a sense of
the variability of the statistics of interest. In a second phase, a
comparable collection of sequences is generated using the manipulated
covariates.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://fabrice-rossi.github.io/" class="external-link">Fabrice Rossi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
