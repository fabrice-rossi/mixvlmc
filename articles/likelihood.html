<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mixvlmc">
<title>Likelihood calculation • mixvlmc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Likelihood calculation">
<meta property="og:description" content="mixvlmc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mixvlmc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/context-trees.html">Context trees</a>
    <a class="dropdown-item" href="../articles/variable-length-markov-chains.html">Variable length Markov chains (VLMC)</a>
    <a class="dropdown-item" href="../articles/covlmc.html">Variable Length Markov Chains with Covariates (COVLMC)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced topics</h6>
    <a class="dropdown-item" href="../articles/likelihood.html">Likelihood calculation</a>
    <a class="dropdown-item" href="../articles/prediction.html">Predicting with (CO)VLMC</a>
    <a class="dropdown-item" href="../articles/sampling.html">Sampling from (CO)VLMC</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/mixvlmc-0-2.html">mixvlmc 0.2.0</a>
    <a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/mixvlmc-0-1.html">mixvlmc 0.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fabrice-rossi/mixvlmc/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Likelihood calculation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fabrice-rossi/mixvlmc/blob/HEAD/vignettes/likelihood.Rmd" class="external-link"><code>vignettes/likelihood.Rmd</code></a></small>
      <div class="d-none name"><code>likelihood.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fabrice-rossi/mixvlmc" class="external-link">mixvlmc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/geodist" class="external-link">geodist</a></span><span class="op">)</span> <span class="co">## used in the earth quake example</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co">## ditto</span></span></code></pre></div>
<p>Most of the theoretical papers on Variable Length Markov Chains
(VLMC, see <code><a href="../articles/variable-length-markov-chains.html">vignette("variable-length-markov-chains")</a></code>) focus
on time series indexed by <span class="math inline">\(\mathbb{Z}\)</span> which simplifies the analysis.
In practice time series are obviously finite which introduces some
difficulties associated to the initial observations. In particular, the
definition of a likelihood function is not entirely obvious.</p>
<p>This vignette discusses the case of VLMC, but the discussion applies
to VLMC with covariates with minimal adaptation.</p>
<div class="section level2">
<h2 id="executive-summary">Executive summary<a class="anchor" aria-label="anchor" href="#executive-summary"></a>
</h2>
<p>For model selection, we recommend to use a likelihood function that
disregards the first few observations for which a (CO)VLMC cannot
provide a context. This is based on the <em>truncated</em> likelihood
function. For all practical uses such as prediction and sampling, we
recommend to use a notion of <em>extended</em> contexts.</p>
</div>
<div class="section level2">
<h2 id="likelihood-functions-for-markov-chains">Likelihood functions for Markov chains<a class="anchor" aria-label="anchor" href="#likelihood-functions-for-markov-chains"></a>
</h2>
<p>Let us consider a doubly infinite time series <span class="math inline">\(X_{i\in\mathbb{Z}}\)</span> generated by some
model <span class="math inline">\(\mathcal{M}\)</span>. The likelihood
function associated to a finite observation of the time series, <span class="math inline">\((x_i)_{1\leq i\leq n}\)</span>, is <span class="math inline">\(\mathbb{P}_{\mathcal{M}}(X_1=x_1,\ldots,X_n=x_n)\)</span>.</p>
<p>If <span class="math inline">\(\mathcal{M}\)</span> is a Markov chain
of order <span class="math inline">\(d\)</span>, then we have <span class="math display">\[
\mathbb{P}_{\mathcal{M}}(X_{d+1}=x_{d+1},\ldots,X_n=x_n)=\prod_{i=d+1}^n\mathbb{P}_{\mathcal{M}}(X_i=x_i|X_{i-1}=x_{i-1},\ldots,X_{i-d}=x_{i-d}).
\]</span> Thus if we know only <span class="math inline">\(x_{1\leq
i\leq n}\)</span> we can compute only the likelihood of <span class="math inline">\((x_i)_{d+1\leq i\leq n}\)</span>.</p>
<p>In practice, comparing models with different orders should be done
only using the likelihood functions based on the same subset of the
observed time series, i.e. using the highest order. As pointed out in
several papers this has no impact on asymptotic results (see e.g. <a href="https://dx.doi.org/10.1109/TIT.2006.881742" class="external-link">Garivier, A. (2006),
Consistency of the unlimited BIC context tree estimator. IEEE
Transactions on Information Theory, 52 (10) 4630–4635</a>).</p>
</div>
<div class="section level2">
<h2 id="likelihood-functions-for-vlmc">Likelihood functions for VLMC<a class="anchor" aria-label="anchor" href="#likelihood-functions-for-vlmc"></a>
</h2>
<div class="section level3">
<h3 id="truncated-solution">Truncated solution<a class="anchor" aria-label="anchor" href="#truncated-solution"></a>
</h3>
<p>The simplest way to define a likelihood function for a single VLMC is
to consider it as a Markov chain of the order given by the length of its
longest context (i.e. of the order of the VLMC).</p>
</div>
<div class="section level3">
<h3 id="specific-contexts">Specific contexts<a class="anchor" aria-label="anchor" href="#specific-contexts"></a>
</h3>
<p>Another approach considers the fact that the past of <span class="math inline">\((x_i)_{1\leq i\leq n}\)</span> is unknown and
replace it by a collection of specific contexts that summarize this
unknown past. This is used in Garivier’s paper cited above. By
definition, each observation that does not have a actual context in the
VLMC appears only once and thus is perfectly predicted by the empirical
distribution associated to it. It has therefore a likelihood of 1. In
practice, this amounts to identifying <span class="math inline">\(\mathbb{P}_{\mathcal{M}}(X_1=x_1,\ldots,X_n=x_n)\)</span>
to <span class="math inline">\(\mathbb{P}_{\mathcal{M}}(X_{d+1}=x_{d+1},\ldots,X_n=x_n)\)</span>.</p>
<p>In terms of parameters for AIC/BIC calculation, this corresponds to
adding a specific parameter for each of the <span class="math inline">\(d\)</span> initial values, where <span class="math inline">\(d\)</span> is the order of the VLMC. Notice that
this departs from Garivier’s approach cited above (in this paper, each
initial value is associated to a full context and thus to <span class="math inline">\(|S|-1\)</span> parameters if <span class="math inline">\(S\)</span> is the state space).</p>
</div>
<div class="section level3">
<h3 id="extended-contexts">Extended contexts<a class="anchor" aria-label="anchor" href="#extended-contexts"></a>
</h3>
<p>Another approach considers extended/approximate contexts for the
<span class="math inline">\(d\)</span> initial values. Indeed each
observation <span class="math inline">\(x_i\)</span> for <span class="math inline">\(1\leq i\leq d\)</span> can be considered has
having its context partially determined by <span class="math inline">\((x_1,\ldots, x_{i-1})\)</span>, in particular by
the empty context for <span class="math inline">\(i=1\)</span>. Let us
consider for instance <span class="math inline">\(x_1\)</span> and the
empty context (the root of the context tree). If <span class="math inline">\(d\geq 1\)</span>, we cannot determine the context
of <span class="math inline">\(x_1\)</span> without values of <span class="math inline">\((x_{-d+1},\ldots, x_0)\)</span> even if the empty
context is a valid one. However, we can assign this empty context to
<span class="math inline">\(x_1\)</span> because of the lack of
information. More generally, we can traverse the context tree using as
many past values as available and stop in the corresponding node which
is then interpreted as a context using the frequencies collected during
the construction of the VLMC.</p>
<p>In terms of parameters, this adds to the VLMC an additional extended
context for each node of the context tree which is not a context. For
instance, in a binary state space <span class="math inline">\(S=\{0,
1\}\)</span>, one may consider a Markov Chain of order 1. In this case,
we have two contexts <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>, and the root node of the context tree
is not a proper (empty) context. To compute the likelihood of the first
observation, we need therefore a new extended context, the empty
one.</p>
</div>
<div class="section level3">
<h3 id="complete-example">Complete example<a class="anchor" aria-label="anchor" href="#complete-example"></a>
</h3>
<p>Let us revisit the California earth quakes example proposed in
<code><a href="../articles/variable-length-markov-chains.html">vignette("variable-length-markov-chains")</a></code>. The model is
obtained as follows (see the vignette for details):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">California_centre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>longitude <span class="op">=</span> <span class="op">-</span><span class="fl">119.449444</span>, latitude <span class="op">=</span> <span class="fl">37.166111</span><span class="op">)</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geodist/man/geodist.html" class="external-link">geodist</a></span><span class="op">(</span><span class="va">globalearthquake</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">California_centre</span>,</span>
<span>  measure <span class="op">=</span> <span class="st">"geodesic"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">California_earth_quakes</span> <span class="op">&lt;-</span> <span class="va">globalearthquake</span><span class="op">[</span><span class="va">distances</span> <span class="op">&lt;</span> <span class="fl">2e6</span>, <span class="op">]</span> <span class="co">## distances are in meters</span></span>
<span><span class="va">California_weeks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">globalearthquake</span><span class="op">$</span><span class="va">nbweeks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">California_weeks</span><span class="op">[</span><span class="va">California_earth_quakes</span><span class="op">$</span><span class="va">nbweeks</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">California_weeks_earth_quakes_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">California_weeks</span>,</span>
<span>  initial <span class="op">=</span> <span class="st">"truncated"</span>,</span>
<span>  save <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">California_weeks_earth_quakes_model</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="va">model</span>, prob <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (5126, 1291)</span></span>
<span><span class="co">#&gt; +-- 0 (4185, 940)</span></span>
<span><span class="co">#&gt; |   +-- 0 (3460, 725)</span></span>
<span><span class="co">#&gt; |   |   '-- 0 (2883, 577)</span></span>
<span><span class="co">#&gt; |   |       '-- 0 (2421, 462)</span></span>
<span><span class="co">#&gt; |   |           '-- 1 (358, 103)</span></span>
<span><span class="co">#&gt; |   '-- 1 (724, 215)</span></span>
<span><span class="co">#&gt; '-- 1 (940, 351)</span></span></code></pre></div>
<p>The optimal model according to the BIC has an order of 5 and thus the
simple truncated log likelihood is obtained by considering only the
observations starting at index 6. We disregard the first 5 observations.
The corresponding log likelihood is</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loglikelihood.html">loglikelihood</a></span><span class="op">(</span><span class="va">model</span>, initial <span class="op">=</span> <span class="st">"truncated"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -3182.077 (df= 6, nb obs.= 6412, initial="truncated")</span></span></code></pre></div>
<p>Using specific contexts amounts to assuming perfect predictions for
the first five observations. The log likelihood is not modified, but it
covers now the full time series, i.e. 6417 observations. The number of
parameters is increased as the initial value is now associated to a
specific parameter leading to a total of 11 parameters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loglikelihood.html">loglikelihood</a></span><span class="op">(</span><span class="va">model</span>, initial <span class="op">=</span> <span class="st">"specific"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -3182.077 (df= 11, nb obs.= 6417, initial="specific")</span></span></code></pre></div>
<p>The extended context approach is the most complex. For the first
observation, we use the empty context, i.e. the root of the context
tree. The associated empirical distribution is <span class="math inline">\(\mathbb{P}(X_1=1)=\frac{1291}{5126+1291}\simeq0.201\)</span>.
Its contribution to the log likelihood is therefore <span class="math inline">\(\log \mathbb{P}(X_1=0)\simeq -0.225\)</span> as
the first observation is equal to 0.</p>
<p>As the root node is not a proper context, the specification of its
associated empirical distribution contributes to the total number of
parameters of the model (i.e. it adds a parameter to the total).</p>
<p>For the second observation, <span class="math inline">\(X_2=0\)</span>, the candidate context is <span class="math inline">\(0\)</span>. However, <span class="math inline">\(0\)</span> is again not a proper context we should
normally look for <span class="math inline">\(X_{0}\)</span> and older
values to find a proper context. In the extended approach, we consider
the empirical distribution of values following a 0 in the time series,
which is given by <span class="math inline">\(\mathbb{P}(X_t=1|X_{t-1}=0)=\frac{940}{4185+940}\simeq0.183\)</span>.
The contribution of this observation to the log likelihood is therefore
<span class="math inline">\(\log \mathbb{P}(X_t=0|X_{t-1}=0)\simeq
-0.203\)</span>. In addition, this extended context adds again a
parameter to the total.</p>
<p>The following observations <span class="math inline">\(X_3\)</span>,
<span class="math inline">\(X_4\)</span> and <span class="math inline">\(X_5\)</span> have all proper contexts and
contribute in a normal way to the (log) likelihood without the need for
additional parameters. Notice that the number of additional parameters
does not depend on the initial sequence but on the structure of the
context tree. Notice also that while the corresponding nodes are
contexts, they are not the contexts of those three values. Those
contexts cannot be computed due to the lack of older values.</p>
<p>The final value is</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loglikelihood.html">loglikelihood</a></span><span class="op">(</span><span class="va">model</span>, initial <span class="op">=</span> <span class="st">"extended"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -3183.052 (df= 8, nb obs.= 6417, initial="extended")</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="monotonicity">Monotonicity<a class="anchor" aria-label="anchor" href="#monotonicity"></a>
</h2>
<div class="section level3">
<h3 id="nested-models">Nested models<a class="anchor" aria-label="anchor" href="#nested-models"></a>
</h3>
<p>For a given time series, the candidate VLMCs generated by the context
algorithm follow a nested structure associated to the pruning operation:
the most complete context tree is pruned recursively in order to
generate less and less complex trees. A context in a small tree is also
a suffix of context of a larger tree. The inclusion order is total
unless some cut off values are identical.</p>
<p>A natural expected property of likelihood functions is to observe a
decrease in likelihood for a given time series when switching from a
model <span class="math inline">\(m_1\)</span> to a simpler model <span class="math inline">\(m_2\)</span> provided their parameters are
estimated by maximum likelihood using this time series, in particular
when <span class="math inline">\(m_2\)</span> is nested in <span class="math inline">\(m_1\)</span> in the sense of the likelihood-ratio
test.</p>
</div>
<div class="section level3">
<h3 id="theoretical-analysis">Theoretical analysis<a class="anchor" aria-label="anchor" href="#theoretical-analysis"></a>
</h3>
<p>Let us consider the case of two VLMC models <span class="math inline">\(m_1\)</span> and <span class="math inline">\(m_2\)</span> where <span class="math inline">\(m_2\)</span> is obtained by pruning <span class="math inline">\(m_1\)</span> (both estimated on <span class="math inline">\((x_i)_{1\leq i\leq n}\)</span>). Let us first
consider <span class="math inline">\((x_i)_{i&gt;d}\)</span> where <span class="math inline">\(d\)</span> is the order of <span class="math inline">\(m_1\)</span>. The contexts of those values are
well defined, both in <span class="math inline">\(m_1\)</span> and <span class="math inline">\(m_2\)</span>. The corresponding probabilities can
be factorised according to the contexts as follows (for <span class="math inline">\(m_1\)</span>) <span class="math display">\[
\mathbb{P}_{m_1}(X_{d+1}=x_{d+1},\ldots,X_n=x_n)=\prod_{c\in
m_1}\prod_{k,\  ctx(m_1, x_k)=c}\mathbb{P}_{m_1}(X_k=x_k|ctx(m_1,
x_k)=c),
\]</span> where with use <span class="math inline">\(ctx(m_1,
x_k)\)</span> to denote the context of <span class="math inline">\(x_k\)</span> in <span class="math inline">\(m_1\)</span> and <span class="math inline">\(c\in
m_1\)</span> to denote all contexts in <span class="math inline">\(m_1\)</span>. We have obviously a similar equation
for <span class="math inline">\(m_2\)</span>.</p>
<p>As <span class="math inline">\(m_2\)</span> is included in <span class="math inline">\(m_1\)</span> we know that each <span class="math inline">\(c\in m_2\)</span> is also the suffix of a context
of <span class="math inline">\(m_1\)</span>. When <span class="math inline">\(c\)</span> is a context in both models, they
concern the same subset of the time series and use therefore the same
estimated conditional probabilities, leading to identical values of
<span class="math display">\[\mathbb{P}_{m_1}(X_k=x_k|ctx(m_1,
x_k)=c)=\mathbb{P}_{m2}(X_k=x_k|ctx(m_2, x_k)=c).\]</span></p>
<p>When <span class="math inline">\(c\)</span> is the suffix of a
context in <span class="math inline">\(m_1\)</span>, there is a
collection of contexts <span class="math inline">\(c'\)</span> for
which <span class="math inline">\(c\)</span> is also a suffix. We have
then <span class="math display">\[
\{k\mid ctx(m_2, x_k)=c\}=\bigcup_{c'\in m_1, c\text{ is a suffix of
}c'}\{j\mid ctx(m_1, x_j)=c'\}.
\]</span> In words, the collection of observations whose context in
<span class="math inline">\(m_1\)</span> has <span class="math inline">\(c\)</span> as a suffix is equal to the collection
of observations chose context in <span class="math inline">\(m_2\)</span> is <span class="math inline">\(c\)</span>. Because the conditional probabilities
are estimated by maximum likelihood, we have then <span class="math display">\[
\begin{multline*}
\prod_{\{k\mid ctx(m_2, x_k)=c\}}\mathbb{P}_{m_2}(X_k=x_k|ctx(m_2,
x_k)=c)\leq\\ \prod_{\{l\mid ctx(m_1, x_k)=c', c\text{ is a suffix
of }c'\}}\mathbb{P}_{m_1}(X_l=x_l|ctx(m_1, x_k)=c').
\end{multline*}
\]</span> Thus overall, as expected, <span class="math display">\[
\mathbb{P}_{m_2}(X_{d+1}=x_{d+1},\ldots,X_n=x_n)\leq
\mathbb{P}_{m_1}(X_{d+1}=x_{d+1},\ldots,X_n=x_n).
\]</span> However, the models may not have the same order. Fortunately,
as probabilities are not larger than 1, we have also <span class="math display">\[
\mathbb{P}_{m_2}(X_{d_{m_2}+1}=x_{d_{m_2}+1},\ldots,X_n=x_n)\leq
\mathbb{P}_{m_1}(X_{d_{m_1}+1}=x_{d_{m_1}+1},\ldots,X_n=x_n),
\]</span> where <span class="math inline">\(d_m\)</span> denotes the
order of model <span class="math inline">\(m\)</span>.</p>
<p>In conclusion, likelihood functions based on <em>truncation</em> or
on <em>specific</em> contexts are non increasing when one moves from a
VLMC to one of its pruned version.</p>
<p>The case of <em>extended</em> contexts is more complex. Using the
hypotheses as above, the extended likelihood includes approximate
contexts for observations <span class="math inline">\(x_{1},\ldots,
x_{d_{m_1}}\)</span> and for <span class="math inline">\(x_{1},\ldots,
x_{d_{m_2}}\)</span>. Let us consider the case where <span class="math inline">\(d_{m_1}=d_{m_2}+1\)</span> (without loss of
generality). The only difference in the extended likelihoods is then
<span class="math inline">\(\mathbb{P}_{m_1}(X_{d_{m_1}}=x_{d_{m_1}}|ectx(m_1,
x_{d_{m_1}}))\)</span> which is computed using the extended context
<span class="math inline">\(ectx(m_1, X_{d_{m_1}})\)</span> and <span class="math inline">\(\mathbb{P}_{m_2}(X_{d_{m_1}}=x_{d_{m_1}}|ctx(m_2,
x_{d_{m_1}}))\)</span> which is computed using the true context.</p>
<p>Notice that <span class="math display">\[
(x_1,\ldots,x_{d_{m_1}-1},x_{d_{m_1}})=(x_1,\ldots,x_{d_{m_2}-1},x_{d_{m_2}},
x_{d_{m_1}})
\]</span> Thus one computes the (extended) context of <span class="math inline">\(x_{d_{m_1}}\)</span>, the <span class="math inline">\(d_{m_2}\)</span> first steps are obviously
identical in <span class="math inline">\(m_1\)</span> and in <span class="math inline">\(m_2\)</span>, as <span class="math inline">\(m_2\)</span> has been obtained by pruning <span class="math inline">\(m_1\)</span>. Depending on the structure of the
context tree, it may be possible possible to determine the true of
context of <span class="math inline">\(x_{d_{m_1}}\)</span> in both
trees and thus the corresponding probabilities will be identical. The
only non obvious situation is when the context of <span class="math inline">\(x_{d_{m_1}}\)</span> cannot be determine in <span class="math inline">\(m_1\)</span>. This is only possible if the context
in <span class="math inline">\(m_2\)</span> is of length <span class="math inline">\(d_{m_2}\)</span> and the corresponding leaf was an
internal node in <span class="math inline">\(m_1\)</span>. Then we use
as the <em>extended</em> context in <span class="math inline">\(m_1\)</span> the <em>normal</em> context of <span class="math inline">\(m_2\)</span> and therefore <span class="math display">\[
\mathbb{P}_{m_1}(X_{d_{m_1}}=x_{d_{m_1}}|ectx(m_1,
x_{d_{m_1}}))=\mathbb{P}_{m_2}(X_{d_{m_1}}=x_{d_{m_1}}|ctx(m_2,
x_{d_{m_1}})).
\]</span></p>
<p>Thus in all cases, in the <em>extended</em> context interpretation,
moving from an extended context to a true context does not change the
probability included in the likelihood. Therefore, the extended
likelihood is also non increasing with the pruning operation.</p>
</div>
<div class="section level3">
<h3 id="experimental-illustration">Experimental illustration<a class="anchor" aria-label="anchor" href="#experimental-illustration"></a>
</h3>
<p>We used the saving options of <code><a href="../reference/tune_vlmc.html">tune_vlmc()</a></code> to keep all
the models considered during the model selection process in the
California earth quakes analysis. We can use them to illustrate non
decreasing behaviour of the likelihoods. For the <em>extended</em>
likelikood, we have:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CA_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">California_weeks_earth_quakes_model</span><span class="op">$</span><span class="va">saved_models</span><span class="op">$</span><span class="va">initial</span><span class="op">)</span>,</span>
<span>  <span class="va">California_weeks_earth_quakes_model</span><span class="op">$</span><span class="va">saved_models</span><span class="op">$</span><span class="va">all</span></span>
<span><span class="op">)</span></span>
<span><span class="va">CA_extended</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CA_models</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">cutoff</span><span class="op">)</span>,</span>
<span>  loglikelihood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CA_models</span>, <span class="va">loglikelihood</span>,</span>
<span>    initial <span class="op">=</span> <span class="st">"extended"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">CA_extended</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">cutoff</span>, <span class="va">loglikelihood</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Cut off (native scale)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Log likelihood"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Extended log likelihood"</span><span class="op">)</span></span></code></pre></div>
<p><img src="likelihood_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>For the <em>specific</em> likelihood we have:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CA_specific</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CA_models</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">cutoff</span><span class="op">)</span>,</span>
<span>  loglikelihood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">CA_models</span>, <span class="va">loglikelihood</span>,</span>
<span>    initial <span class="op">=</span> <span class="st">"specific"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">CA_specific</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">cutoff</span>, <span class="va">loglikelihood</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Cut off (native scale)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Log likelihood"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Specific log likelihood"</span><span class="op">)</span></span></code></pre></div>
<p><img src="likelihood_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;">
Notice that the time series contains 6417 observations and the maximum
order considered by <code><a href="../reference/tune_vlmc.html">tune_vlmc()</a></code> is 29, thus we do not
expect to observe large differences between the different log
likelihoods. This is illustrated on the following figure:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CW_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">CA_extended</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cutoff"</span>, <span class="st">"loglikelihood"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">CA_specific</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cutoff"</span>, <span class="st">"loglikelihood"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">CW_combined</span><span class="op">[[</span><span class="st">"Likelihood function"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"extended"</span>, <span class="st">"specific"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">California_weeks_earth_quakes_model</span><span class="op">$</span><span class="va">results</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">CW_combined</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">cutoff</span>, <span class="va">loglikelihood</span>, color <span class="op">=</span> <span class="va">`Likelihood function`</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Cut off (native scale)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Log likelihood"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Log likelihood"</span><span class="op">)</span></span></code></pre></div>
<p><img src="likelihood_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The case of the <em>truncated</em> likelihood is more complex. As
noted above, the numerical values of the <em>truncated</em> likelihood
are identical to the values of the <em>specific</em> likelihood and thus
the above graphical representations are also valid for it. However care
must be exercised when using the <em>truncated</em> likelihood for model
selection, as explained below.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-selection">Model selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h2>
<p>Optimal (CO)VLMC models are generally selected via penalized
likelihood approaches, with a preference for the BIC, based on its
asymptotic consistency. A natural question is to what extent the
different likelihood functions proposed above are adapted for model
selection when combined with a penalty. Notice that consistency results
for the BIC are generally obtained with a <em>truncated</em> likelihood
function.</p>
<div class="section level3">
<h3 id="specific-and-extended-likelihood">Specific and extended likelihood<a class="anchor" aria-label="anchor" href="#specific-and-extended-likelihood"></a>
</h3>
<p>The <em>specific</em> and the <em>extended</em> likelihood functions
do not introduce any obvious difficulty. In particular, they work with
the full data set as they extend the VLMC model with specific/extended
contexts for the initial values. However, they tend to penalize complex
models more than the <em>truncated</em> likelihood. For instance, the
model selected on the California earth quakes is simpler than the one
selected with the <em>truncated</em> likelihood (as well as by the
<em>specific</em> one):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CA_model_extented</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">California_weeks</span>, initial <span class="op">=</span> <span class="st">"extended"</span><span class="op">)</span></span>
<span><span class="va">model_extended</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">CA_model_extented</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="va">model_extended</span>, prob <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (5126, 1291)</span></span>
<span><span class="co">#&gt; '-- 1 (940, 351)</span></span></code></pre></div>
<p>This is also the case for, e.g., the sun spot time series used in the
introduction to the package, as shown below:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sun_activity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sunspot.year</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">sunspot.year</span><span class="op">)</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sun_model_tune_truncated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">sun_activity</span>, initial <span class="op">=</span> <span class="st">"truncated"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">sun_model_tune_truncated</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (0.5052, 0.4948)</span></span>
<span><span class="co">#&gt; +-- high (0.8207, 0.1793)</span></span>
<span><span class="co">#&gt; |   +-- high (0.7899, 0.2101)</span></span>
<span><span class="co">#&gt; |   |   +-- high (0.7447, 0.2553)</span></span>
<span><span class="co">#&gt; |   |   |   +-- high (0.6571, 0.3429)</span></span>
<span><span class="co">#&gt; |   |   |   |   '-- low (0.9167, 0.08333)</span></span>
<span><span class="co">#&gt; |   |   |   '-- low (1, 0)</span></span>
<span><span class="co">#&gt; |   |   '-- low (0.96, 0.04)</span></span>
<span><span class="co">#&gt; |   '-- low (0.9615, 0.03846)</span></span>
<span><span class="co">#&gt; '-- low (0.1888, 0.8112)</span></span>
<span><span class="co">#&gt;     +-- high (0, 1)</span></span>
<span><span class="co">#&gt;     '-- low (0.2328, 0.7672)</span></span>
<span><span class="co">#&gt;         +-- high (0, 1)</span></span>
<span><span class="co">#&gt;         '-- low (0.3034, 0.6966)</span></span>
<span><span class="co">#&gt;             '-- high (0.07692, 0.9231)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sun_model_tune_extended</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">sun_activity</span>, initial <span class="op">=</span> <span class="st">"extended"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">sun_model_tune_extended</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (0.5052, 0.4948)</span></span>
<span><span class="co">#&gt; +-- high (0.8207, 0.1793)</span></span>
<span><span class="co">#&gt; |   '-- high (0.7899, 0.2101)</span></span>
<span><span class="co">#&gt; |       '-- high (0.7447, 0.2553)</span></span>
<span><span class="co">#&gt; |           +-- high (0.6571, 0.3429)</span></span>
<span><span class="co">#&gt; |           |   '-- low (0.9167, 0.08333)</span></span>
<span><span class="co">#&gt; |           '-- low (1, 0)</span></span>
<span><span class="co">#&gt; '-- low (0.1888, 0.8112)</span></span>
<span><span class="co">#&gt;     +-- high (0, 1)</span></span>
<span><span class="co">#&gt;     '-- low (0.2328, 0.7672)</span></span>
<span><span class="co">#&gt;         '-- high (0, 1)</span></span></code></pre></div>
<p>In this latter case, the <em>specific</em> likelihood gives the same
results as the <em>truncated</em> one.</p>
<p>We observe a similar behaviour on a simple second order Markov chain
generated as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TM0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">TM1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">init</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dts</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">dts</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">TM0</span><span class="op">[</span><span class="va">dts</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">TM1</span><span class="op">[</span><span class="va">dts</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">dts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">probs</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once again, the <em>extended</em> likelihood tends to over penalize
“complex” models</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MC_extended</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">dts</span>, initial <span class="op">=</span> <span class="st">"extended"</span>, save <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">MC_extended</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (0.5458, 0.4542)</span></span>
<span><span class="co">#&gt; '-- 1 (0.5746, 0.4254)</span></span>
<span><span class="co">#&gt;     +-- 0 (0.374, 0.626)</span></span>
<span><span class="co">#&gt;     '-- 1 (0.8454, 0.1546)</span></span></code></pre></div>
<p>while thishappens neither for the <em>truncated</em> likelihood</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MC_truncated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">dts</span>, initial <span class="op">=</span> <span class="st">"truncated"</span>, save <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">MC_truncated</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (0.5458, 0.4542)</span></span>
<span><span class="co">#&gt; +-- 0 (0.5201, 0.4799)</span></span>
<span><span class="co">#&gt; |   +-- 0 (0.6408, 0.3592)</span></span>
<span><span class="co">#&gt; |   '-- 1 (0.3923, 0.6077)</span></span>
<span><span class="co">#&gt; '-- 1 (0.5746, 0.4254)</span></span>
<span><span class="co">#&gt;     +-- 0 (0.374, 0.626)</span></span>
<span><span class="co">#&gt;     '-- 1 (0.8454, 0.1546)</span></span></code></pre></div>
<p>no for the <em>specific</em> likelihood</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MC_specific</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">dts</span>, initial <span class="op">=</span> <span class="st">"specific"</span>, save <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw.html">draw</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">MC_specific</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; * (0.5458, 0.4542)</span></span>
<span><span class="co">#&gt; +-- 0 (0.5201, 0.4799)</span></span>
<span><span class="co">#&gt; |   +-- 0 (0.6408, 0.3592)</span></span>
<span><span class="co">#&gt; |   '-- 1 (0.3923, 0.6077)</span></span>
<span><span class="co">#&gt; '-- 1 (0.5746, 0.4254)</span></span>
<span><span class="co">#&gt;     +-- 0 (0.374, 0.626)</span></span>
<span><span class="co">#&gt;     '-- 1 (0.8454, 0.1546)</span></span></code></pre></div>
<p>If we increase the number of observations in the synthetic example,
to e.g. 5000, the three likelihood functions conduct to the same optimal
(and true) model, as expected. On smaller data sets, the use of the
<em>truncated</em> seem to be more adapted.</p>
</div>
<div class="section level3">
<h3 id="truncated-likelihood">Truncated likelihood<a class="anchor" aria-label="anchor" href="#truncated-likelihood"></a>
</h3>
<p>However, the <em>truncated</em> likelihood function is problematic
when used naively. The difficulty comes from the discarded observations:
two VLMC models with different orders are evaluated on different data
sets. If we consider for instance the BIC as an approximation of the
logarithm of the evidence of the data given the model, it is obvious
that one cannot compare directly two models on different data sets.</p>
<p>A possible solution for model selection based on the
<em>truncated</em> likelihood consists in choosing a maximal order, say
<span class="math inline">\(D\)</span> and in evaluating the models only
on <span class="math inline">\((x_i)_{D+1\leq i\leq n}\)</span> so that
contexts are always computable. This amounts to additional truncation
for simpler models. The solution is used by <code><a href="../reference/tune_vlmc.html">tune_vlmc()</a></code> and
<code><a href="../reference/tune_covlmc.html">tune_covlmc()</a></code>. All the examples given above have been
constructed using this approach.</p>
</div>
</div>
<div class="section level2">
<h2 id="coherence-with-other-uses-of-a-vlmc">Coherence with other uses of a VLMC<a class="anchor" aria-label="anchor" href="#coherence-with-other-uses-of-a-vlmc"></a>
</h2>
<div class="section level3">
<h3 id="sampling">Sampling<a class="anchor" aria-label="anchor" href="#sampling"></a>
</h3>
<p>As detailed in <code><a href="../articles/sampling.html">vignette("sampling")</a></code> a VLMC model can be
used to generate new discrete time series based on the conditional
probability distributions associated to the contexts. However, raw VLMC
models do not specify distributions for the initial values for which no
proper context exists.</p>
<p>The difficulty is generally circumvented by using a constant
initialisation coupled with a burn in phase. This is supported by the
theoretical results on VLMC bootstrap proved by Bühlmann and Wyner in <a href="https://dx.doi.org/10.1214/aos/1018031204" class="external-link">their seminal
paper</a>. Indeed the hypothesis used in the paper ensure an exponential
mix-in for Markov Chain and thus the initial values play essentially no
role in the stationary distribution, provided the burn in period is
“<em>long enough</em>”.</p>
<p>In practice, it is difficult to verify that the conditions of the
theorem apply and to turns them into actual numerical values of a
<em>long enough</em> burn in time. Thus we use in
<code><a href="../reference/simulate.vlmc.html">simulate.vlmc()</a></code> the extended contexts proposed above. This
extends the VLMC into a full model, with specific probability
distributions for the initial values. This does not prevent e.g. slow
mix-in and this does not change the stationary distribution when it
exists, but this gives some coherence between the <em>extended</em>
likelihood function and sampling. Notice that we also support burn in
period as well as a manual specification of the initial values of a
sample.</p>
</div>
<div class="section level3">
<h3 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h3>
<p>A VLMC can also be used for one step ahead prediction of a time
series (or even for multiple steps ahead), as implement in
<code><a href="../reference/predict.vlmc.html">predict.vlmc()</a></code>. This poses obviously the same problem as
sampling or likelihood calculation for the initial values. We use in
<code><a href="../reference/predict.vlmc.html">predict.vlmc()</a></code> the extended contexts proposed above, using
the same extended VLMC model principle. This provides full coherence
between sampling, likelihood calculation and prediction.</p>
<p>The <code><a href="../reference/metrics.vlmc.html">metrics.vlmc()</a></code> function computes predictive
performances of a VLMC on the time series used to estimate it.
Predictions used for those computations are also based on the extended
context principle.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://fabrice-rossi.github.io/" class="external-link">Fabrice Rossi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
