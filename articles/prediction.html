<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mixvlmc">
<title>Predicting with (CO)VLMC • mixvlmc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predicting with (CO)VLMC">
<meta property="og:description" content="mixvlmc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mixvlmc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Getting started</h6>
    <a class="dropdown-item" href="../articles/context-trees.html">Context trees</a>
    <a class="dropdown-item" href="../articles/variable-length-markov-chains.html">Variable length Markov chains (VLMC)</a>
    <a class="dropdown-item" href="../articles/covlmc.html">Variable Length Markov Chains with Covariates (COVLMC)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced topics</h6>
    <a class="dropdown-item" href="../articles/likelihood.html">Likelihood calculation</a>
    <a class="dropdown-item" href="../articles/prediction.html">Predicting with (CO)VLMC</a>
    <a class="dropdown-item" href="../articles/sampling.html">Sampling from (CO)VLMC</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/mixvlmc-0-2.html">mixvlmc 0.2.0</a>
    <a class="external-link dropdown-item" href="https://fabrice-rossi.github.io/blog/posts/mixvlmc-0-1.html">mixvlmc 0.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fabrice-rossi/mixvlmc/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Predicting with (CO)VLMC</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fabrice-rossi/mixvlmc/blob/HEAD/vignettes/prediction.Rmd" class="external-link"><code>vignettes/prediction.Rmd</code></a></small>
      <div class="d-none name"><code>prediction.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/fabrice-rossi/mixvlmc" class="external-link">mixvlmc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Once a (CO)VLMC has been estimated from a sequence, it can used to
make one step or multiple steps ahead prediction on sequences using the
same state space. The predictions can be expressed as probabilities on
the state space for the future value of the time series or directly as
the most likely value considering the past of the time series.</p>
<div class="section level3">
<h3 id="vlmc-case">VLMC case<a class="anchor" aria-label="anchor" href="#vlmc-case"></a>
</h3>
<p>Mixvlmc implements one-step-ahead prediction. This is done in a
straightforward way, apart for the initial values. Indeed, given a time
series <span class="math inline">\((x_i)_{1\leq i\leq n}\)</span> and a
VLMC of order <span class="math inline">\(d\)</span>, the context of
<span class="math inline">\(x_j\)</span> for <span class="math inline">\(j&gt;d\)</span> can be determined from the <span class="math inline">\(d\)</span> past values <span class="math display">\[
x_{j-d}, x_{j-d+1}, \ldots, x_{j-1}.
\]</span> In the VLMC case, this context is associated to a conditional
probability distribution for <span class="math inline">\(X_j\)</span>.
This distribution can be reported directly as the “prediction” for <span class="math inline">\(x_j\)</span>, or a direct prediction can be made
using <span class="math display">\[
\arg\max_{x\in
S}\mathbb{P}(X_j=x|X_{j-1}=x_{j-1},\ldots,X_{j-d}=x_{j-d}),
\]</span> where <span class="math inline">\(S\)</span> is the state
space of the VLMC. Notice than this can be used to predict <span class="math inline">\(x_{n+1}\)</span> which is unknown, making actual
predictions.</p>
</div>
<div class="section level3">
<h3 id="covlmc-case">COVLMC case<a class="anchor" aria-label="anchor" href="#covlmc-case"></a>
</h3>
<p>The case of COVLMC is almost identical. The only difference comes
from the covariate influence. One-step-ahead predictions can be made
only if the time series of covariates is provided.</p>
<p>Once the context of <span class="math inline">\(x_j\)</span> has been
computed as in the case of a VLMC, we obtain from the COVLMC the
conditional distribution <span class="math display">\[
\mathbb{P}(X_j|X_{j-1}=x_{j-1},\ldots,X_{j-d}=x_{j-d}, Y_{j-1}=y_{j-1},
\ldots,
Y_{j-h}=y_{j-h}),
\]</span> where <span class="math inline">\(h\)</span> is the order of
covariate dependency for this context.</p>
<p>The distribution can be reported or a prediction can be made using
the mode of the distribution, exactly as in the VLMC case.</p>
</div>
<div class="section level3">
<h3 id="initial-values">Initial values<a class="anchor" aria-label="anchor" href="#initial-values"></a>
</h3>
<p>The only difficulty comes in both cases from the initial values <span class="math inline">\(x_1\)</span> to <span class="math inline">\(x_d\)</span> for which no proper context can be
determined. This issue appears in numerous situations when using
(CO)VLMC models, in particular for likelihood calculation (see
<code><a href="../articles/likelihood.html">vignette("likelihood")</a></code>) and for sampling (see
<code><a href="../articles/sampling.html">vignette("sampling")</a></code>).</p>
<p>We use the notion of <em>extended context</em> described in detail in
the likelihood vignette. The key idea is to include in the (CO)VLMC
additional contexts (and thus conditional distributions) to model the
first few observations.</p>
</div>
</div>
<div class="section level2">
<h2 id="in-practice">In practice<a class="anchor" aria-label="anchor" href="#in-practice"></a>
</h2>
<div class="section level3">
<h3 id="vlmc">VLMC<a class="anchor" aria-label="anchor" href="#vlmc"></a>
</h3>
<p>Let us consider for example the sun spot time series,
<code>sunspot.year</code>, seen as a binary time series, with high
activity associated to a number of sun spots larger than the median
number.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sun_activity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sunspot.year</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">sunspot.year</span><span class="op">)</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We adjust automatically an optimal VLMC as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sun_model_tune</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">sun_activity</span><span class="op">)</span></span>
<span><span class="va">sun_model_tune</span></span>
<span><span class="co">#&gt; VLMC context tree on high, low </span></span>
<span><span class="co">#&gt;  cutoff: 2.306 (quantile: 0.03175)</span></span>
<span><span class="co">#&gt;  Number of contexts: 9 </span></span>
<span><span class="co">#&gt;  Maximum context length: 5 </span></span>
<span><span class="co">#&gt;  Selected by BIC (236.262) with likelihood function "truncated" (-98.83247)</span></span></code></pre></div>
<p>Predictions are obtained as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sun_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">sun_model_tune</span><span class="op">)</span></span>
<span><span class="va">sun_model_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">sun_model</span>, <span class="va">sun_activity</span><span class="op">)</span></span></code></pre></div>
<p>Notice that contrarily to many implementations of
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">stats::predict()</a></code>, we do not support predictions without new
data, but the original time series can of course be used as the “new
data”.</p>
<p>Predictions are relatively correct, as shown by the confusion
matrix:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sun_model_predictions</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sun_model_predictions</span><span class="op">)</span><span class="op">]</span>, <span class="va">sun_activity</span><span class="op">)</span></span>
<span><span class="co">#&gt;       sun_activity</span></span>
<span><span class="co">#&gt;        high low</span></span>
<span><span class="co">#&gt;   high  119  27</span></span>
<span><span class="co">#&gt;   low    27 116</span></span></code></pre></div>
<p>Notice that we remove the last prediction to be able to perform the
comparison. We could have asked for it to be excluded directly by
passing <code>final_pred=FALSE</code> to the <code><a href="../reference/predict.vlmc.html">predict.vlmc()</a></code>
function.</p>
<p>The BIC used by default in <code>tune_vlmc</code> may be too
conservative for prediction or sampling oriented use of the final model.
With the AIC, we obtain a more complex model as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sun_model_tune_aic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">sun_activity</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">sun_model_tune_aic</span></span>
<span><span class="co">#&gt; VLMC context tree on high, low </span></span>
<span><span class="co">#&gt;  cutoff: 2.306 (quantile: 0.03175)</span></span>
<span><span class="co">#&gt;  Number of contexts: 9 </span></span>
<span><span class="co">#&gt;  Maximum context length: 5 </span></span>
<span><span class="co">#&gt;  Selected by AIC (203.711) with likelihood function "truncated" (-98.83247)</span></span></code></pre></div>
<p>As expected it has a slightly better confusion matrix on its
estimation data set:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">sun_model_tune_aic</span><span class="op">)</span>, <span class="va">sun_activity</span>, final_pred <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  <span class="va">sun_activity</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;       sun_activity</span></span>
<span><span class="co">#&gt;        high low</span></span>
<span><span class="co">#&gt;   high  119  27</span></span>
<span><span class="co">#&gt;   low    27 116</span></span></code></pre></div>
<p>Despite the use of penalized likelihood, we may experiment some form
of overfitting and a split sample approach could be used to study it.
For instance, one can use AIC to build a VLMC on the first half of the
sun spots time series and evaluate the quality of the predictions on the
second half, as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_half</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sun_activity</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sun_model_tune_aic_half</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_vlmc.html">tune_vlmc</a></span><span class="op">(</span><span class="va">sun_activity</span><span class="op">[</span><span class="va">first_half</span><span class="op">]</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">sun_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">sun_model_tune_aic_half</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">sun_model</span>, <span class="va">sun_activity</span><span class="op">[</span><span class="op">-</span><span class="va">first_half</span><span class="op">]</span>, final_pred <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  <span class="va">sun_activity</span><span class="op">[</span><span class="op">-</span><span class="va">first_half</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;       </span></span>
<span><span class="co">#&gt;        high low</span></span>
<span><span class="co">#&gt;   high   67  13</span></span>
<span><span class="co">#&gt;   low    14  51</span></span></code></pre></div>
<p>The predictions remain of a rather good quality.</p>
</div>
<div class="section level3">
<h3 id="covlmc">COVLMC<a class="anchor" aria-label="anchor" href="#covlmc"></a>
</h3>
<p>To illustrate COVLMC predictions, we use the French CAC index
provided in <code>EuStockMarkets</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span><span class="op">$</span><span class="va">CAC</span></span></code></pre></div>
<p>We turn it into a discrete time series with three values:</p>
<ul>
<li>Stay if the value of the index on day t+1 is between 99.5% and
100.5% of the value on day t</li>
<li>Up if the value increased by at least 0.5%</li>
<li>Down if the value decreased by at least 0.5%</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_rel_evol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">CAC_raw</span><span class="op">)</span> <span class="op">/</span> <span class="va">CAC_raw</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">CAC_raw</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">CAC_dts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CAC_rel_evol</span> <span class="op">&gt;=</span> <span class="fl">0.005</span>, <span class="st">"Up"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">CAC_rel_evol</span> <span class="op">&lt;=</span> <span class="op">-</span><span class="fl">0.005</span>, <span class="st">"Down"</span>, <span class="st">"Stay"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Down"</span>, <span class="st">"Stay"</span>, <span class="st">"Up"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We use the other indexes of <code>EuStockMarkets</code> as
covariates. As previously, we select a model with the AIC criterion:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">EuStockMarkets</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DAX"</span>, <span class="st">"SMI"</span>, <span class="st">"FTSE"</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">CAC_covlmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_covlmc.html">tune_covlmc</a></span><span class="op">(</span><span class="va">CAC_dts</span>, <span class="va">CAC_covariates</span>, criterion <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span>
<span><span class="va">CAC_comodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_covlmc.html">as_covlmc</a></span><span class="op">(</span><span class="va">CAC_covlmc</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we obtain predictions using
<code><a href="../reference/predict.covlmc.html">predict.covlmc()</a></code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">CAC_comodel</span>, <span class="va">CAC_dts</span>, <span class="va">CAC_covariates</span>, final_pred <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>In this case, the predictions are of rather poor quality:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">CAC_pred</span>, <span class="va">CAC_dts</span><span class="op">)</span></span>
<span><span class="co">#&gt;         CAC_dts</span></span>
<span><span class="co">#&gt; CAC_pred Down Stay  Up</span></span>
<span><span class="co">#&gt;     Down   40   46  36</span></span>
<span><span class="co">#&gt;     Stay  453  625 467</span></span>
<span><span class="co">#&gt;     Up     36   65  91</span></span></code></pre></div>
<p>This can be easily explained by the large ambiguity of the
conditional distributions as can be observed by focusing on them rather
than on predictions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">CAC_comodel</span>, <span class="va">CAC_dts</span>, <span class="va">CAC_covariates</span>, final_pred <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"probs"</span><span class="op">)</span></span>
<span><span class="va">CAC_probs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;            Down      Stay        Up</span></span>
<span><span class="co">#&gt;  [1,] 0.2841765 0.3961249 0.3196986</span></span>
<span><span class="co">#&gt;  [2,] 0.2878788 0.4073084 0.3048128</span></span>
<span><span class="co">#&gt;  [3,] 0.2878788 0.4073084 0.3048128</span></span>
<span><span class="co">#&gt;  [4,] 0.2878788 0.4073084 0.3048128</span></span>
<span><span class="co">#&gt;  [5,] 0.2878788 0.4073084 0.3048128</span></span>
<span><span class="co">#&gt;  [6,] 0.2878788 0.4073084 0.3048128</span></span>
<span><span class="co">#&gt;  [7,] 0.2878788 0.4073084 0.3048128</span></span>
<span><span class="co">#&gt;  [8,] 0.2878788 0.4073084 0.3048128</span></span>
<span><span class="co">#&gt;  [9,] 0.4248040 0.3124036 0.2627924</span></span>
<span><span class="co">#&gt; [10,] 0.3747649 0.4891093 0.1361259</span></span></code></pre></div>
<p>The Shannon entropies of those conditional distributions are
generally relatively close to the maximum in this setting, i.e. 1.09861,
as shown on this graphical illustration</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">entropies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>entropy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">CAC_probs</span>, <span class="fl">1</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">entropies</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">entropy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="prediction_files/figure-html/unnamed-chunk-15-1.png" width="700" style="display: block; margin: auto;">
This illustrate the fact that (CO)VLMC models are not predictive models
but rather generative models. They may perform well on predictive tasks
if the conditional distributions are peaked enough, which corresponds in
a way to simple predictive cases.</p>
<p>For example, the case of the sun spots studied above for the VLMC has
better predictive performances because of the presence of strongly
peaked distributions (some of them are even deterministic), as shown
below:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sun_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">sun_model_tune_aic</span><span class="op">)</span>, <span class="va">sun_activity</span>,</span>
<span>  final_pred <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"probs"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sun_entropies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>entropy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span></span>
<span>  <span class="va">sun_probs</span>, <span class="fl">1</span>,</span>
<span>  \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sun_entropies</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">entropy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="prediction_files/figure-html/unnamed-chunk-16-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This while (CO)VLMC based predictions can be interesting, one will
generaly obtained more insights about the original time series using
simulations, as detailed in <code><a href="../articles/sampling.html">vignette("sampling")</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="metrics">Metrics<a class="anchor" aria-label="anchor" href="#metrics"></a>
</h2>
<p>In addition to <code><a href="../reference/predict.vlmc.html">predict.vlmc()</a></code> and
<code><a href="../reference/predict.covlmc.html">predict.covlmc()</a></code>, mixvlmc provides a <code><a href="../reference/metrics.html">metrics()</a></code>
function which computes and reports a collection of classification
oriented quality metrics computed on the time series (and covariates)
used to estimate the (CO)VLMC model. Those metrics could be computed
easily using the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> functions, but
<code><a href="../reference/metrics.html">metrics()</a></code> is faster and does not need the original
data.</p>
<div class="section level3">
<h3 id="vlmc-1">VLMC<a class="anchor" aria-label="anchor" href="#vlmc-1"></a>
</h3>
<p>For instance for the sun spots complex AIC model, we obtain</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sun_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metrics.html">metrics</a></span><span class="op">(</span><span class="fu"><a href="../reference/as_vlmc.html">as_vlmc</a></span><span class="op">(</span><span class="va">sun_model_tune_aic</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sun_metrics</span></span>
<span><span class="co">#&gt; VLMC context tree on high, low </span></span>
<span><span class="co">#&gt;  cutoff: 2.306 (quantile: 0.03175)</span></span>
<span><span class="co">#&gt;  Number of contexts: 9 </span></span>
<span><span class="co">#&gt;  Maximum context length: 5 </span></span>
<span><span class="co">#&gt;  Confusion matrix: </span></span>
<span><span class="co">#&gt;        high low </span></span>
<span><span class="co">#&gt;   high 119  27  </span></span>
<span><span class="co">#&gt;   low  27   116 </span></span>
<span><span class="co">#&gt;  Accuracy: 0.8131 </span></span>
<span><span class="co">#&gt;  AUC: 0.9146</span></span></code></pre></div>
<p>The ROC curve is computed by <code><a href="../reference/metrics.html">metrics()</a></code> (for state space
of size 2) and can be plotted simply using:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sun_metrics</span><span class="op">$</span><span class="va">roc</span><span class="op">)</span></span></code></pre></div>
<p><img src="prediction_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="covlmc-1">COVLMC<a class="anchor" aria-label="anchor" href="#covlmc-1"></a>
</h3>
<p>Similarly, the CAC model gives:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAC_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metrics.html">metrics</a></span><span class="op">(</span><span class="va">CAC_comodel</span><span class="op">)</span></span>
<span><span class="va">CAC_metrics</span></span>
<span><span class="co">#&gt; VLMC with covariate context tree on Down, Stay, Up </span></span>
<span><span class="co">#&gt;  cutoff in quantile scale: 0.01046</span></span>
<span><span class="co">#&gt;  Number of contexts: 5 </span></span>
<span><span class="co">#&gt;  Maximum context length: 2 </span></span>
<span><span class="co">#&gt;  Confusion matrix: </span></span>
<span><span class="co">#&gt;        Down Stay Up  </span></span>
<span><span class="co">#&gt;   Down 40   46   36  </span></span>
<span><span class="co">#&gt;   Stay 453  625  467 </span></span>
<span><span class="co">#&gt;   Up   36   65   91  </span></span>
<span><span class="co">#&gt;  Accuracy: 0.4067 </span></span>
<span><span class="co">#&gt;  AUC: 0.5507</span></span></code></pre></div>
<p>When the state space contains three or more states, we report the
generalized AUC proposed by Hand and Till in <a href="https://doi.org/10.1023/A:1010920819831" class="external-link">A Simple Generalisation
of the Area Under the ROC Curve for Multiple Class Classification
Problems</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://fabrice-rossi.github.io/" class="external-link">Fabrice Rossi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
